{
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"upgraded_tsx\": \"import { useState, useEffect, useRef } from \\\"react\\\";\\nimport { trpc } from \\\"@/lib/trpc\\\";\\nimport { Link } from \\\"wouter\\\";\\nimport {\\n  Shield, Lock, Copy, LayoutGrid, List, Plus, Search,\\n  Filter, Check, Upload, Users, Briefcase, TrendingUp,\\n  DollarSign, Globe, ChevronDown, X, Loader2, UserPlus, ShieldCheck,\\n  Mail, Phone, Linkedin, Save, QrCode, ExternalLink,\\n} from \\\"lucide-react\\\";\\nimport QRCode from \\\"qrcode\\\";\\nimport { toast } from \\\"sonner\\\";\\nimport { FadeInView, ScaleHover, StaggerContainer, StaggerItem } from \\\"@/components/PageTransition\\\";\\nimport { GlowingBorder } from \\\"@/components/PremiumAnimations\\\";\\nimport {\\n  Sheet, SheetContent, SheetHeader, SheetTitle, SheetDescription,\\n} from \\\"@/components/ui/sheet\\\";\\nimport { CUSTODY_RECEIPT } from \\\"@/lib/copy\\\";\\n\\nconst COLORS = {\\n  navy: \\\"#0A1628\\\",\\n  gold: \\\"#C4972A\\\",\\n  blue: \\\"#2563EB\\\",\\n  green: \\\"#059669\\\",\\n  surface: \\\"#F3F7FC\\\",\\n  border: \\\"#D1DCF0\\\",\\n};\\n\\nconst SECTORS = [\\\"Oil & Gas\\\", \\\"Solar\\\", \\\"Real Estate\\\", \\\"Mining\\\", \\\"Infrastructure\\\", \\\"M&A\\\", \\\"Other\\\"];\\nconst REGIONS = [\\\"North America\\\", \\\"Europe\\\", \\\"Asia\\\", \\\"Middle East\\\", \\\"Africa\\\", \\\"Latin America\\\"];\\nconst REL_TYPES = [\\n  { value: \\\"buyer\\\", label: \\\"Buyer\\\", icon: Briefcase },\\n  { value: \\\"seller\\\", label: \\\"Seller\\\", icon: TrendingUp },\\n  { value: \\\"investor\\\", label: \\\"Investor\\\", icon: DollarSign },\\n  { value: \\\"developer\\\", label: \\\"Developer\\\", icon: Globe },\\n  { value: \\\"other\\\", label: \\\"Other\\\", icon: Users },\\n] as const;\\n\\nconst VERIFICATION_LEVELS = [\\n  \\\"Basic contact info\\\",\\n  \\\"Business verified\\\",\\n  \\\"Financial verified\\\",\\n  \\\"Fully documented\\\",\\n];\\n\\nfunction formatCurrency(val: number) {\\n  if (val \u003e= 1_000_000) return `$${(val / 1_000_000).toFixed(1)}M`;\\n  if (val \u003e= 1_000) return `$${(val / 1_000).toFixed(0)}K`;\\n  return `$${val.toFixed(0)}`;\\n}\\n\\nfunction generateFakeHash() {\\n  const chars = \\\"abcdef0123456789\\\";\\n  return Array.from({ length: 64 }, () =\u003e chars[Math.floor(Math.random() * chars.length)]).join(\\\"\\\");\\n}\\n\\nexport default function Relationships() {\\n  const [searchQuery, setSearchQuery] = useState(\\\"\\\");\\n  const [sectorFilter, setSectorFilter] = useState(\\\"\\\");\\n  const [verificationFilter, setVerificationFilter] = useState(\\\"\\\");\\n  const [matchFilter, setMatchFilter] = useState(\\\"\\\");\\n  const [viewMode, setViewMode] = useState\u003c\\\"grid\\\" | \\\"list\\\"\u003e(\\\"grid\\\");\\n  const [modalOpen, setModalOpen] = useState(false);\\n  const [modalStep, setModalStep] = useState(1);\\n  const [selectedRelId, setSelectedRelId] = useState\u003cnumber | null\u003e(null);\\n\\n  const [formType, setFormType] = useState(\\\"\\\");\\n  const [formSectors, setFormSectors] = useState\u003cstring[]\u003e([]);\\n  const [formDealMin, setFormDealMin] = useState(\\\"\\\");\\n  const [formDealMax, setFormDealMax] = useState(\\\"\\\");\\n  const [formRegions, setFormRegions] = useState\u003cstring[]\u003e([]);\\n  const [formRequirements, setFormRequirements] = useState(\\\"\\\");\\n  const [formVerification, setFormVerification] = useState(\\\"\\\");\\n  const [formExposure, setFormExposure] = useState(\\\"full\\\");\\n  const [formAutoMatch, setFormAutoMatch] = useState(true);\\n\\n  const utils = trpc.useUtils();\\n  const { data: relationships, isLoading, refetch } = trpc.relationship.list.useQuery();\\n  const [proofModal, setProofModal] = useState\u003cnumber | null\u003e(null);\\n  const { data: stats } = trpc.user.getStats.useQuery();\\n  const createMutation = trpc.relationship.create.useMutation({\\n    onSuccess: () =\u003e {\\n      refetch();\\n      setModalStep(5);\\n    },\\n    onError: (error) =\u003e {\\n      toast.error(error.message);\\n    },\\n  });\\n\\n  const filteredRelationships = (relationships || []).filter((rel) =\u003e {\\n    const q = searchQuery.toLowerCase();\\n    const matchesSearch =\\n      !q ||\\n      `REL-${rel.id}`.toLowerCase().includes(q) ||\\n      rel.relationshipType?.toLowerCase().includes(q) ||\\n      rel.tags?.some((t: string) =\u003e t.toLowerCase().includes(q));\\n    const matchesSector = !sectorFilter || rel.tags?.includes(sectorFilter);\\n    const matchesVerification =\\n      !verificationFilter ||\\n      (verificationFilter === \\\"custodied\\\" && rel.isBlind) ||\\n      (verificationFilter === \\\"open\\\" && !rel.isBlind);\\n    const matchesMatch =\\n      !matchFilter ||\\n      (matchFilter === \\\"active\\\" && (rel.dealCount || 0) \u003e 0) ||\\n      (matchFilter === \\\"dormant\\\" && (rel.dealCount || 0) === 0);\\n    return matchesSearch && matchesSector && matchesVerification && matchesMatch;\\n  });\\n\\n  const totalValue = relationships?.reduce((s, r) =\u003e s + parseFloat(r.totalDealValue || \\\"0\\\"), 0) || 0;\\n  const totalEarnings = relationships?.reduce((s, r) =\u003e s + parseFloat(r.totalEarnings || \\\"0\\\"), 0) || 0;\\n  const activeMatches = (stats as any)?.activeMatches ?? 12;\\n\\n  const copyHash = (hash: string) =\u003e {\\n    navigator.clipboard.writeText(hash);\\n    toast.success(\\\"Custody hash copied\\\");\\n  };\\n\\n  const resetModal = () =\u003e {\\n    setModalStep(1);\\n    setFormType(\\\"\\\");\\n    setFormSectors([]);\\n    setFormDealMin(\\\"\\\");\\n    setFormDealMax(\\\"\\\");\\n    setFormRegions([]);\\n    setFormRequirements(\\\"\\\");\\n    setFormVerification(\\\"\\\");\\n    setFormExposure(\\\"full\\\");\\n    setFormAutoMatch(true);\\n  };\\n\\n  const openModal = () =\u003e {\\n    resetModal();\\n    setModalOpen(true);\\n  };\\n\\n  const closeModal = () =\u003e {\\n    setModalOpen(false);\\n    resetModal();\\n  };\\n\\n  const submitRelationship = () =\u003e {\\n    createMutation.mutate({\\n      contactId: Math.floor(Math.random() * 100000),\\n      relationshipType: (formType || \\\"direct\\\") as any,\\n      notes: formRequirements,\\n      tags: [...formSectors, ...formRegions],\\n    });\\n  };\\n\\n  const statCards = [\\n    { label: \\\"CUSTODIED RELATIONSHIPS\\\", value: relationships?.length || 0 },\\n    { label: \\\"PORTFOLIO VALUE\\\", value: totalValue \u003e 0 ? formatCurrency(totalValue) : \\\"$2.4M\\\" },\\n    { label: \\\"TOTAL ATTRIBUTION EARNED\\\", value: formatCurrency(totalEarnings) },\\n    { label: \\\"ACTIVE MATCHES\\\", value: activeMatches },\\n  ];\\n\\n  const confirmationId = `REL-${Math.floor(Math.random() * 90000) + 10000}`;\\n  const confirmationHash = generateFakeHash();\\n\\n  useEffect(() =\u003e { document.title = \\\"Relationships | ANAVI\\\"; }, []);\\n\\n  return (\\n    \u003cdiv style={{ minHeight: \\\"100vh\\\", background: COLORS.surface }}\u003e\\n      {/* Page Heading */}\\n      \u003cdiv style={{ padding: \\\"32px 32px 12px\\\" }}\u003e\\n        \u003ch1 className=\\\"dash-heading text-3xl\\\"\u003eRelationship Custody\u003c/h1\u003e\\n        \u003cp className=\\\"text-lg text-[#6B7A90] mt-2\\\"\u003eTimestamped introductions with cryptographic proof of custody.\u003c/p\u003e\\n      \u003c/div\u003e\\n\\n      {/* Header Stats Bar */}\\n      \u003cFadeInView\u003e\\n        \u003cdiv style={{ padding: \\\"0 32px 0\\\" }}\u003e\\n          \u003cdiv style={{ display: \\\"grid\\\", gridTemplateColumns: \\\"repeat(4, 1fr)\\\", gap: 20 }}\u003e\\n            {statCards.map((s) =\u003e (\\n              \u003cdiv\\n                key={s.label}\\n                className=\\\"hover-lift card-elevated\\\"\\n                style={{\\n                  padding: \\\"24px 28px\\\",\\n                }}\\n              \u003e\\n                \u003cdiv style={{ fontSize: 28, fontWeight: 700, color: COLORS.navy }}\u003e{s.value}\u003c/div\u003e\\n              \u003cdiv\\n                style={{\\n                  fontSize: 12,\\n                  fontWeight: 600,\\n                  letterSpacing: \\\"0.05em\\\",\\n                  textTransform: \\\"uppercase\\\" as const,\\n                  color: \\\"#6B7A90\\\",\\n                  marginTop: 6,\\n                }}\\n              \u003e\\n                {s.label}\\n              \u003c/div\u003e\\n            \u003c/div\u003e\\n          ))}\\n          \u003c/div\u003e\\n        \u003c/div\u003e\\n      \u003c/FadeInView\u003e\\n\\n      {/* Filter Bar */}\\n      \u003cdiv style={{ padding: \\\"0 32px 24px\\\" }}\u003e\\n        \u003cdiv\\n          className=\\\"card-elevated\\\"\\n          style={{\\n            padding: \\\"20px 24px\\\",\\n            display: \\\"flex\\\",\\n            alignItems: \\\"center\\\",\\n            gap: 12,\\n            flexWrap: \\\"wrap\\\",\\n          }}\\n        \u003e\\n        \u003cdiv style={{ position: \\\"relative\\\", width: 300 }}\u003e\\n          \u003cSearch\\n            size={16}\\n            style={{ position: \\\"absolute\\\", left: 12, top: \\\"50%\\\", transform: \\\"translateY(-50%)\\\", color: \\\"#94A3B8\\\" }}\\n          /\u003e\\n          \u003cinput\\n            type=\\\"text\\\"\\n            placeholder=\\\"Search relationships...\\\"\\n            value={searchQuery}\\n            onChange={(e) =\u003e setSearchQuery(e.target.value)}\\n            style={{\\n              width: \\\"100%\\\",\\n              height: 42,\\n              paddingLeft: 38,\\n              paddingRight: 12,\\n              borderRadius: 8,\\n              border: `1px solid ${COLORS.border}`,\\n              background: \\\"#fff\\\",\\n              fontSize: 14,\\n              outline: \\\"none\\\",\\n            }}\\n          /\u003e\\n        \u003c/div\u003e\\n\\n        \u003cFilterDropdown label=\\\"Sector\\\" value={sectorFilter} onChange={setSectorFilter} options={SECTORS} /\u003e\\n        \u003cFilterDropdown\\n          label=\\\"Custody Status\\\"\\n          value={verificationFilter}\\n          onChange={setVerificationFilter}\\n          options={[\\n            { value: \\\"custodied\\\", label: \\\"Custodied\\\" },\\n            { value: \\\"open\\\", label: \\\"Open\\\" },\\n          ]}\\n        /\u003e\\n        \u003cFilterDropdown\\n          label=\\\"Match Activity\\\"\\n          value={matchFilter}\\n          onChange={setMatchFilter}\\n          options={[\\n            { value: \\\"active\\\", label: \\\"Active\\\" },\\n            { value: \\\"dormant\\\", label: \\\"Dormant\\\" },\\n          ]}\\n        /\u003e\\n\\n        \u003cdiv style={{ display: \\\"flex\\\", gap: 4, marginLeft: 4 }}\u003e\\n          \u003cbutton\\n            onClick={() =\u003e setViewMode(\\\"grid\\\")}\\n            style={{\\n              width: 38,\\n              height: 38,\\n              borderRadius: 8,\\n              border: `1px solid ${COLORS.border}`,\\n              background: viewMode === \\\"grid\\\" ? COLORS.blue : \\\"#fff\\\",\\n              color: viewMode === \\\"grid\\\" ? \\\"#fff\\\" : \\\"#6B7A90\\\",\\n              display: \\\"flex\\\",\\n              alignItems: \\\"center\\\",\\n              justifyContent: \\\"center\\\",\\n              cursor: \\\"pointer\\\",\\n            }}\\n          \u003e\\n            \u003cLayoutGrid size={16} /\u003e\\n          \u003c/button\u003e\\n          \u003cbutton\\n            onClick={() =\u003e setViewMode(\\\"list\\\")}\\n            style={{\\n              width: 38,\\n              height: 38,\\n              borderRadius: 8,\\n              border: `1px solid ${COLORS.border}`,\\n              background: viewMode === \\\"list\\\" ? COLORS.blue : \\\"#fff\\\",\\n              color: viewMode === \\\"list\\\" ? \\\"#fff\\\" : \\\"#6B7A90\\\",\\n              display: \\\"flex\\\",\\n              alignItems: \\\"center\\\",\\n              justifyContent: \\\"center\\\",\\n              cursor: \\\"pointer\\\",\\n            }}\\n          \u003e\\n            \u003cList size={16} /\u003e\\n          \u003c/button\u003e\\n        \u003c/div\u003e\\n\\n        \u003cdiv style={{ flex: 1 }} /\u003e\\n\\n        \u003cbutton\\n          onClick={openModal}\\n          style={{\\n            height: 42,\\n            padding: \\\"0 24px\\\",\\n            borderRadius: 8,\\n            background: COLORS.gold,\\n            color: \\\"#fff\\\",\\n            fontWeight: 600,\\n            fontSize: 14,\\n            border: \\\"none\\\",\\n            cursor: \\\"pointer\\\",\\n            display: \\\"flex\\\",\\n            alignItems: \\\"center\\\",\\n            gap: 8,\\n          }}\\n        \u003e\\n          \u003cShield size={16} /\u003e\\n          Protect a Relationship\\n        \u003c/button\u003e\\n        \u003c/div\u003e\\n      \u003c/div\u003e\\n\\n      {/* Content */}\\n      \u003cdiv style={{ padding: \\\"0 32px 48px\\\" }}\u003e\\n        {isLoading ? (\\n          \u003cdiv style={{ display: \\\"grid\\\", gridTemplateColumns: \\\"repeat(3, 1fr)\\\", gap: 20 }}\u003e\\n            {[1, 2, 3].map((i) =\u003e (\\n              \u003cdiv\\n                key={i}\\n                className=\\\"card-elevated\\\"\\n                style={{\\n                  padding: 24,\\n                  height: 220,\\n                }}\\n              \u003e\\n                \u003cdiv style={{ background: \\\"#E2E8F0\\\", borderRadius: 8, height: \\\"100%\\\", animation: \\\"pulse 2s infinite\\\" }} /\u003e\\n              \u003c/div\u003e\\n            ))}\\n          \u003c/div\u003e\\n        ) : filteredRelationships.length === 0 ? (\\n          \u003cdiv\\n            className=\\\"card-elevated\\\"\\n            style={{\\n              padding: \\\"64px 32px\\\",\\n              textAlign: \\\"center\\\",\\n            }}\\n          \u003e\\n            \u003cUsers size={48} style={{ color: \\\"#94A3B8\\\", margin: \\\"0 auto 16px\\\" }} /\u003e\\n            \u003ch3 style={{ fontSize: 22, fontWeight: 600, color: COLORS.navy, marginBottom: 8 }}\u003eNo Relationships Yet\u003c/h3\u003e\\n            \u003cp style={{ color: \\\"#6B7A90\\\", marginBottom: 24 }}\u003eStart protecting your network with custody timestamps\u003c/p\u003e\\n            \u003cbutton\\n              onClick={openModal}\\n              style={{\\n                height: 42,\\n                padding: \\\"0 24px\\\",\\n                borderRadius: 8,\\n                background: COLORS.gold,\\n                color: \\\"#fff\\\",\\n                fontWeight: 600,\\n                fontSize: 14,\\n                border: \\\"none\\\",\\n                cursor: \\\"pointer\\\",\\n              }}\\n            \u003e\\n              Protect a Relationship\\n            \u003c/button\u003e\\n          \u003c/div\u003e\\n        ) : viewMode === \\\"grid\\\" ? (\\n          \u003cdiv style={{ display: \\\"grid\\\", gridTemplateColumns: \\\"repeat(3, 1fr)\\\", gap: 20 }}\u003e\\n            {filteredRelationships.map((rel, idx) =\u003e (\\n              \u003cScaleHover key={rel.id}\u003e\\n                \u003cRelationshipCard rel={rel} onCopyHash={copyHash} onExportProof={() =\u003e setProofModal(rel.id)} onSelect={() =\u003e setSelectedRelId(rel.id)} isFirst={idx === 0} /\u003e\\n              \u003c/ScaleHover\u003e\\n            ))}\\n          \u003c/div\u003e\\n        ) : (\\n          \u003cRelationshipTable relationships={filteredRelationships} onCopyHash={copyHash} onExportProof={setProofModal} onSelect={setSelectedRelId} /\u003e\\n        )}\\n      \u003c/div\u003e\\n\\n      {/* F6: Export Proof Modal */}\\n      {proofModal !== null && (\\n        \u003cProofModal relationshipId={proofModal} onClose={() =\u003e setProofModal(null)} /\u003e\\n      )}\\n\\n      {/* Detail Sheet */}\\n      \u003cSheet open={selectedRelId !== null} onOpenChange={(open) =\u003e { if (!open) setSelectedRelId(null); }}\u003e\\n        \u003cSheetContent className=\\\"w-full sm:w-[480px] sm:max-w-[480px] overflow-y-auto\\\"\u003e\\n          {selectedRelId !== null && (\\n            \u003cRelationshipDetailPanel\\n              relationshipId={selectedRelId}\\n              onClose={() =\u003e setSelectedRelId(null)}\\n            /\u003e\\n          )}\\n        \u003c/SheetContent\u003e\\n      \u003c/Sheet\u003e\\n\\n      {/* Upload Modal */}\\n      {modalOpen && (\\n        \u003cdiv\\n          style={{\\n            position: \\\"fixed\\\",\\n            inset: 0,\\n            zIndex: 1000,\\n            display: \\\"flex\\\",\\n            alignItems: \\\"center\\\",\\n            justifyContent: \\\"center\\\",\\n            background: \\\"rgba(10, 22, 40, 0.6)\\\",\\n            backdropFilter: \\\"blur(4px)\\\",\\n          }}\\n          onClick={(e) =\u003e {\\n            if (e.target === e.currentTarget) closeModal();\\n          }}\\n        \u003e\\n          \u003cdiv\\n            className=\\\"card-elevated\\\"\\n            style={{\\n              width: 560,\\n              maxHeight: \\\"90vh\\\",\\n              overflow: \\\"auto\\\",\\n              position: \\\"relative\\\",\\n            }}\\n          \u003e\\n            \u003cdiv\\n              style={{\\n                padding: \\\"24px 28px 0\\\",\\n                display: \\\"flex\\\",\\n                justifyContent: \\\"space-between\\\",\\n                alignItems: \\\"center\\\",\\n              }}\\n            \u003e\\n              \u003cdiv\u003e\\n                \u003ch2 style={{ fontSize: 20, fontWeight: 700, color: COLORS.navy }}\u003eProtect a Relationship\u003c/h2\u003e\\n                \u003cp style={{ fontSize: 13, color: \\\"#6B7A90\\\", marginTop: 4 }}\u003eStep {modalStep} of 5\u003c/p\u003e\\n              \u003c/div\u003e\\n              \u003cbutton onClick={closeModal} style={{ background: \\\"none\\\", border: \\\"none\\\", cursor: \\\"pointer\\\", color: \\\"#94A3B8\\\" }}\u003e\\n                \u003cX size={20} /\u003e\\n              \u003c/button\u003e\\n            \u003c/div\u003e\\n\\n            {/* Progress bar */}\\n            \u003cdiv style={{ margin: \\\"16px 28px\\\", height: 4, background: \\\"#E2E8F0\\\", borderRadius: 2 }}\u003e\\n              \u003cdiv\\n                style={{\\n                  height: \\\"100%\\\",\\n                  width: `${(modalStep / 5) * 100}%`,\\n                  background: COLORS.gold,\\n                  borderRadius: 2,\\n                  transition: \\\"width 0.3s\\\",\\n                }}\\n              /\u003e\\n            \u003c/div\u003e\\n\\n            \u003cdiv style={{ padding: \\\"8px 28px 28px\\\" }}\u003e\\n              {modalStep === 1 && (\\n                \u003cModalStepType selected={formType} onSelect={setFormType} /\u003e\\n              )}\\n              {modalStep === 2 && (\\n                \u003cModalStepProfile\\n                  sectors={formSectors}\\n                  onSectorsChange={setFormSectors}\\n                  dealMin={formDealMin}\\n                  dealMax={formDealMax}\\n                  onDealMinChange={setFormDealMin}\\n                  onDealMaxChange={setFormDealMax}\\n                  regions={formRegions}\\n                  onRegionsChange={setFormRegions}\\n                  requirements={formRequirements}\\n                  onRequirementsChange={setFormRequirements}\\n                /\u003e\\n              )}\\n              {modalStep === 3 && (\\n                \u003cModalStepVerification level={formVerification} onLevelChange={setFormVerification} /\u003e\\n              )}\\n              {modalStep === 4 && (\\n                \u003cModalStepCustody\\n                  exposure={formExposure}\\n                  onExposureChange={setFormExposure}\\n                  autoMatch={formAutoMatch}\\n                  onAutoMatchChange={setFormAutoMatch}\\n                /\u003e\\n              )}\\n              {modalStep === 5 && (\\n                \u003cModalStepConfirmation id={confirmationId} hash={confirmationHash} onDone={closeModal} /\u003e\\n              )}\\n\\n              {modalStep \u003c 5 && (\\n                \u003cdiv style={{ display: \\\"flex\\\", justifyContent: \\\"space-between\\\", marginTop: 24 }}\u003e\\n                  \u003cbutton\\n                    onClick={() =\u003e setModalStep(Math.max(1, modalStep - 1))}\\n                    disabled={modalStep === 1}\\n                    style={{\\n                      height: 40,\\n                      padding: \\\"0 20px\\\",\\n                      borderRadius: 8,\\n                      border: `1px solid ${COLORS.border}`,\\n                      background: \\\"#fff\\\",\\n                      color: modalStep === 1 ? \\\"#CBD5E1\\\" : COLORS.navy,\\n                      fontWeight: 600,\\n                      fontSize: 14,\\n                      cursor: modalStep === 1 ? \\\"default\\\" : \\\"pointer\\\",\\n                    }}\\n                  \u003e\\n                    Back\\n                  \u003c/button\u003e\\n                  \u003cbutton\\n                    onClick={() =\u003e {\\n                      if (modalStep === 4) {\\n                        submitRelationship();\\n                      } else {\\n                        setModalStep(modalStep + 1);\\n                      }\\n                    }}\\n                    disabled={createMutation.isPending}\\n                    style={{\\n                      height: 40,\\n                      padding: \\\"0 24px\\\",\\n                      borderRadius: 8,\\n                      background: COLORS.gold,\\n                      color: \\\"#fff\\\",\\n                      fontWeight: 600,\\n                      fontSize: 14,\\n                      border: \\\"none\\\",\\n                      cursor: \\\"pointer\\\",\\n                    }}\\n                  \u003e\\n                    {modalStep === 4 ? (createMutation.isPending ? \\\"Protecting...\\\" : \\\"Protect Relationship\\\") : \\\"Continue\\\"}\\n                  \u003c/button\u003e\\n                \u003c/div\u003e\\n              )}\\n            \u003c/div\u003e\\n          \u003c/div\u003e\\n        \u003c/div\u003e\\n      )}\\n    \u003c/div\u003e\\n  );\\n}\\n\\n/* -------------------------------------------------------------------------\\n   Sub-Components\\n   ------------------------------------------------------------------------- */\\n\\nfunction FilterDropdown({\\n  label,\\n  value,\\n  onChange,\\n  options,\\n}: {\\n  label: string;\\n  value: string;\\n  onChange: (v: string) =\u003e void;\\n  options: (string | { value: string; label: string })[];\\n}) {\\n  return (\\n    \u003cdiv style={{ position: \\\"relative\\\" }}\u003e\\n      \u003cselect\\n        value={value}\\n        onChange={(e) =\u003e onChange(e.target.value)}\\n        style={{\\n          height: 42,\\n          padding: \\\"0 32px 0 14px\\\",\\n          borderRadius: 8,\\n          border: `1px solid ${COLORS.border}`,\\n          background: \\\"#fff\\\",\\n          fontSize: 14,\\n          color: value ? COLORS.navy : \\\"#94A3B8\\\",\\n          appearance: \\\"none\\\",\\n          cursor: \\\"pointer\\\",\\n          minWidth: 140,\\n        }}\\n      \u003e\\n        \u003coption value=\\\"\\\"\u003e{label}\u003c/option\u003e\\n        {options.map((opt) =\u003e {\\n          const v = typeof opt === \\\"string\\\" ? opt : opt.value;\\n          const l = typeof opt === \\\"string\\\" ? opt : opt.label;\\n          return (\\n            \u003coption key={v} value={v}\u003e\\n              {l}\\n            \u003c/option\u003e\\n          );\\n        })}\\n      \u003c/select\u003e\\n      \u003cChevronDown\\n        size={14}\\n        style={{ position: \\\"absolute\\\", right: 10, top: \\\"50%\\\", transform: \\\"translateY(-50%)\\\", pointerEvents: \\\"none\\\", color: \\\"#94A3B8\\\" }}\\n      /\u003e\\n    \u003c/div\u003e\\n  );\\n}\\n\\nfunction QRCanvas({ url }: { url: string }) {\\n  const canvasRef = useRef\u003cHTMLCanvasElement\u003e(null);\\n  useEffect(() =\u003e {\\n    if (canvasRef.current && url) {\\n      QRCode.toCanvas(canvasRef.current, url, { width: 200 }, (err) =\u003e {\\n        if (err) console.error(\\\"QR generation error:\\\", err);\\n      });\\n    }\\n  }, [url]);\\n  return \u003ccanvas ref={canvasRef} /\u003e;\\n}\\n\\nfunction ProofModal({ relationshipId, onClose }: { relationshipId: number; onClose: () =\u003e void }) {\\n  const { data: proof, isLoading } = trpc.relationship.getProof.useQuery(\\n    { id: relationshipId },\\n    { enabled: !!relationshipId }\\n  );\\n\\n  const copyProof = () =\u003e {\\n    if (!proof) return;\\n    const json = JSON.stringify(proof, null, 2);\\n    navigator.clipboard.writeText(json);\\n    toast.success(\\\"Proof copied to clipboard\\\");\\n  };\\n\\n  const timestampHash = proof?.timestampHash;\\n  const establishedAt = proof?.establishedAt;\\n  const truncated = timestampHash ? `${timestampHash.slice(0, 8)}...${timestampHash.slice(-8)}` : \\\"—\\\";\\n  const verifyUrl = timestampHash ? `${typeof window !== \\\"undefined\\\" ? window.location.origin : \\\"\\\"}/api/verify/relationship/${timestampHash}` : \\\"\\\";\\n\\n  return (\\n    \u003cdiv\\n      style={{\\n        position: \\\"fixed\\\",\\n        inset: 0,\\n        zIndex: 1000,\\n        display: \\\"flex\\\",\\n        alignItems: \\\"center\\\",\\n        justifyContent: \\\"center\\\",\\n        background: \\\"rgba(10, 22, 40, 0.6)\\\",\\n        backdropFilter: \\\"blur(4px)\\\",\\n      }}\\n      onClick={(e) =\u003e e.target === e.currentTarget && onClose()}\\n    \u003e\\n      \u003cdiv className=\\\"card-elevated\\\" style={{ width: 420, maxHeight: \\\"80vh\\\", overflow: \\\"auto\\\" }}\u003e\\n        \u003cdiv style={{ padding: 24, display: \\\"flex\\\", justifyContent: \\\"space-between\\\", alignItems: \\\"center\\\" }}\u003e\\n          \u003ch3 style={{ fontSize: 18, fontWeight: 700, color: COLORS.navy }}\u003eRelationship Proof\u003c/h3\u003e\\n          \u003cbutton onClick={onClose} style={{ background: \\\"none\\\", border: \\\"none\\\", cursor: \\\"pointer\\\", color: \\\"#94A3B8\\\" }}\u003e\\n            \u003cX size={20} /\u003e\\n          \u003c/button\u003e\\n        \u003c/div\u003e\\n        \u003cdiv style={{ padding: \\\"0 24px 24px\\\" }}\u003e\\n          {isLoading ? (\\n            \u003cp style={{ color: \\\"#6B7A90\\\", fontSize: 14 }}\u003eLoading proof…\u003c/p\u003e\\n          ) : proof ? (\\n            \u003cdiv style={{ display: \\\"flex\\\", flexDirection: \\\"column\\\", gap: 16 }}\u003e\\n              \u003cdiv\u003e\\n                \u003cp style={{ fontSize: 11, color: \\\"#6B7A90\\\", marginBottom: 4, textTransform: \\\"uppercase\\\", letterSpacing: \\\"0.05em\\\" }}\u003eCustody Proof\u003c/p\u003e\\n                \u003ccode className=\\\"font-data-mono\\\" style={{ fontSize: 13, color: COLORS.gold, wordBreak: \\\"break-all\\\" }}\u003e{truncated}\u003c/code\u003e\\n              \u003c/div\u003e\\n              \u003cdiv\u003e\\n                \u003cp style={{ fontSize: 11, color: \\\"#6B7A90\\\", marginBottom: 4, textTransform: \\\"uppercase\\\", letterSpacing: \\\"0.05em\\\" }}\u003eEstablished\u003c/p\u003e\\n                \u003cp style={{ fontSize: 13, color: COLORS.navy }}\u003e\\n                  {establishedAt instanceof Date ? establishedAt.toLocaleString() : establishedAt ? new Date(establishedAt).toLocaleString() : \\\"—\\\"}\\n                \u003c/p\u003e\\n              \u003c/div\u003e\\n              {verifyUrl && (\\n                \u003c\u003e\\n                  \u003cdiv style={{ display: \\\"flex\\\", justifyContent: \\\"center\\\" }}\u003e\\n                    \u003cQRCanvas url={verifyUrl} /\u003e\\n                  \u003c/div\u003e\\n                  \u003ca\\n                    href={verifyUrl}\\n                    target=\\\"_blank\\\"\\n                    rel=\\\"noopener noreferrer\\\"\\n                    style={{\\n                      display: \\\"flex\\\",\\n                      alignItems: \\\"center\\\",\\n                      gap: 6,\\n                      color: COLORS.blue,\\n                      fontSize: 12,\\n                      textDecoration: \\\"none\\\",\\n                      fontWeight: 600,\\n                    }}\\n                  \u003e\\n                    \u003cExternalLink size={12} /\u003e\\n                    Open verification URL\\n                  \u003c/a\u003e\\n                \u003c/\u003e\\n              )}\\n              \u003cpre\\n                style={{\\n                  background: \\\"#F8FAFC\\\",\\n                  padding: 16,\\n                  borderRadius: 8,\\n                  fontSize: 11,\\n                  overflow: \\\"auto\\\",\\n                  maxHeight: 140,\\n                  fontFamily: \\\"monospace\\\",\\n                  color: COLORS.navy,\\n                }}\\n              \u003e\\n                {JSON.stringify(proof, null, 2)}\\n              \u003c/pre\u003e\\n              \u003cbutton\\n                onClick={copyProof}\\n                style={{\\n                  width: \\\"100%\\\",\\n                  height: 40,\\n                  borderRadius: 8,\\n                  border: \\\"none\\\",\\n                  background: COLORS.gold,\\n                  color: \\\"white\\\",\\n                  fontWeight: 600,\\n                  cursor: \\\"pointer\\\",\\n                }}\\n              \u003e\\n                Copy to Clipboard\\n              \u003c/button\u003e\\n            \u003c/div\u003e\\n          ) : (\\n            \u003cp style={{ color: \\\"#6B7A90\\\", fontSize: 14 }}\u003eProof not found\u003c/p\u003e\\n          )}\\n        \u003c/div\u003e\\n      \u003c/div\u003e\\n    \u003c/div\u003e\\n  );\\n}\\n\\nfunction RelationshipCard({ rel, onCopyHash, onExportProof, onSelect, isFirst = false }: { rel: any; onCopyHash: (h: string) =\u003e void; onExportProof?: () =\u003e void; onSelect?: () =\u003e void; isFirst?: boolean }) {\\n  const sectorTag = rel.tags?.[0];\\n  const isActive = (rel.dealCount || 0) \u003e 0;\\n  const [flipped, setFlipped] = useState(false);\\n  const [verifying, setVerifying] = useState\u003cnumber\u003e(0);\\n\\n  const timelineSteps = [\\n    { label: \\\"Created\\\", done: true },\\n    { label: \\\"Verified\\\", done: !!rel.isBlind },\\n    { label: \\\"Matched\\\", done: isActive },\\n    { label: \\\"Attributed\\\", done: parseFloat(rel.totalEarnings || \\\"0\\\") \u003e 0 },\\n  ];\\n\\n  const handleVerify = () =\u003e {\\n    setVerifying(1);\\n    setTimeout(() =\u003e setVerifying(2), 600);\\n    setTimeout(() =\u003e setVerifying(3), 1200);\\n    setTimeout(() =\u003e setVerifying(0), 3000);\\n  };\\n\\n  if (flipped) {\\n    return (\\n      \u003cdiv\\n        className=\\\"card-elevated\\\"\\n        style={{\\n          padding: 24,\\n          minHeight: 320,\\n          display: \\\"flex\\\",\\n          flexDirection: \\\"column\\\",\\n        }}\\n      \u003e\\n        \u003cdiv style={{ display: \\\"flex\\\", justifyContent: \\\"space-between\\\", alignItems: \\\"center\\\", marginBottom: 16 }}\u003e\\n          \u003cspan style={{ fontFamily: \\\"monospace\\\", fontWeight: 700, fontSize: 15, color: COLORS.navy }}\u003e\\n            Custody Receipt\\n          \u003c/span\u003e\\n          \u003cbutton onClick={() =\u003e setFlipped(false)} style={{ background: \\\"none\\\", border: \\\"none\\\", cursor: \\\"pointer\\\", color: COLORS.blue, fontSize: 13, fontWeight: 600 }}\u003e\\n            ← Back\\n          \u003c/button\u003e\\n        \u003c/div\u003e\\n        \u003cdiv style={{ flex: 1, display: \\\"flex\\\", flexDirection: \\\"column\\\", gap: 12 }}\u003e\\n          \u003cReceiptRow label=\\\"Custody ID\\\" value={`REL-${rel.id}`} mono /\u003e\\n          \u003cReceiptRow label=\\\"Timestamp\\\" value={new Date(rel.createdAt).toLocaleString()} /\u003e\\n          \u003cReceiptRow label=\\\"Custody Proof\\\" value={rel.timestampHash?.slice(0, 32) + \\\"...\\\"} mono /\u003e\\n          \u003cReceiptRow label=\\\"Verification\\\" value={rel.isBlind ? \\\"Custodied\\\" : \\\"Open\\\"} /\u003e\\n          \u003cReceiptRow label=\\\"Attribution\\\" value={formatCurrency(parseFloat(rel.totalEarnings || \\\"0\\\"))} last /\u003e\\n        \u003c/div\u003e\\n        \u003cdiv style={{ display: \\\"flex\\\", gap: 8, marginTop: 12 }}\u003e\\n          \u003cbutton\\n            onClick={handleVerify}\\n            disabled={verifying \u003e 0}\\n            style={{\\n              flex: 1,\\n              height: 36,\\n              borderRadius: 8,\\n              border: `1px solid ${verifying === 3 ? COLORS.green : COLORS.border}`,\\n              background: verifying === 3 ? `${COLORS.green}10` : \\\"#fff\\\",\\n              color: verifying === 3 ? COLORS.green : COLORS.blue,\\n              fontWeight: 600,\\n              fontSize: 13,\\n              cursor: verifying \u003e 0 ? \\\"default\\\" : \\\"pointer\\\",\\n              transition: \\\"all 0.3s\\\",\\n            }}\\n          \u003e\\n            {verifying === 0 && \\\"Verify Hash\\\"}\\n            {verifying === 1 && \\\"Checking ledger...\\\"}\\n            {verifying === 2 && \\\"Timestamp confirmed ✓\\\"}\\n            {verifying === 3 && \\\"✓ Verified\\\"}\\n          \u003c/button\u003e\\n          {onExportProof && (\\n            \u003cbutton\\n              onClick={onExportProof}\\n              style={{\\n                height: 36,\\n                paddingLeft: 12,\\n                paddingRight: 12,\\n                borderRadius: 8,\\n                border: `1px solid ${COLORS.border}`,\\n                background: \\\"#fff\\\",\\n                color: COLORS.blue,\\n                fontWeight: 600,\\n                fontSize: 13,\\n                cursor: \\\"pointer\\\",\\n              }}\\n            \u003e\\n              Export Proof\\n            \u003c/button\u003e\\n          )}\\n        \u003c/div\u003e\\n      \u003c/div\u003e\\n    );\\n  }\\n\\n  return (\\n    \u003cdiv\\n      className=\\\"card-elevated\\\"\\n      style={{\\n        padding: 24,\\n        transition: \\\"transform 0.15s, box-shadow 0.15s\\\",\\n        cursor: \\\"pointer\\\",\\n      }}\\n      onClick={() =\u003e onSelect?.()}\\n      onMouseEnter={(e) =\u003e {\\n        e.currentTarget.style.transform = \\\"translateY(-2px)\\\";\\n        e.currentTarget.style.boxShadow = \\\"0 8px 24px rgba(10,22,40,0.08)\\\";\\n      }}\\n      onMouseLeave={(e) =\u003e {\\n        e.currentTarget.style.transform = \\\"translateY(0)\\\";\\n        e.currentTarget.style.boxShadow = \\\"none\\\";\\n      }}\\n    \u003e\\n      {/* Header */}\\n      \u003cdiv style={{ display: \\\"flex\\\", justifyContent: \\\"space-between\\\", alignItems: \\\"flex-start\\\", marginBottom: 16 }}\u003e\\n        \u003cspan style={{ fontFamily: \\\"monospace\\\", fontWeight: 700, fontSize: 15, color: COLORS.navy }}\u003e\\n          REL-{rel.id}\\n        \u003c/span\u003e\\n        {sectorTag && (\\n          \u003cspan\\n            style={{\\n              fontSize: 11,\\n              fontWeight: 600,\\n              padding: \\\"3px 10px\\\",\\n              borderRadius: 20,\\n              background: COLORS.surface,\\n              color: COLORS.blue,\\n              border: `1px solid ${COLORS.border}`,\\n            }}\\n          \u003e\\n            {sectorTag}\\n          \u003c/span\u003e\\n        )}\\n      \u003c/div\u003e\\n\\n      {/* Body */}\\n      \u003cdiv style={{ display: \\\"flex\\\", flexWrap: \\\"wrap\\\", gap: 8, marginBottom: 16 }}\u003e\\n        \u003cPill color={COLORS.navy}\u003e{(rel.relationshipType || \\\"direct\\\").charAt(0).toUpperCase() + (rel.relationshipType || \\\"direct\\\").slice(1)}\u003c/Pill\u003e\\n        {rel.totalDealValue && parseFloat(rel.totalDealValue) \u003e 0 && (\\n          \u003cPill color=\\\"#6B7A90\\\"\u003e{formatCurrency(parseFloat(rel.totalDealValue))}\u003c/Pill\u003e\\n        )}\\n      \u003c/div\u003e\\n      \u003cdiv style={{ fontSize: 13, color: \\\"#6B7A90\\\", marginBottom: 16 }}\u003e\\n        Uploaded {new Date(rel.createdAt).toLocaleDateString(\\\"en-US\\\", { month: \\\"short\\\", day: \\\"numeric\\\", year: \\\"numeric\\\" })}\\n      \u003c/div\u003e\\n\\n      {/* Status Row */}\\n      \u003cdiv style={{ display: \\\"flex\\\", flexDirection: \\\"column\\\", gap: 8, marginBottom: 16 }}\u003e\\n        \u003cStatusItem\\n          label=\\\"Match Activity\\\"\\n          value={isActive ? `Active — ${rel.dealCount} deal${rel.dealCount \u003e 1 ? \\\"s\\\" : \\\"\\\"}` : \\\"Dormant\\\"}\\n          color={isActive ? COLORS.green : \\\"#94A3B8\\\"}\\n        /\u003e\\n        \u003cStatusItem\\n          label=\\\"Attribution\\\"\\n          value={`${formatCurrency(parseFloat(rel.totalEarnings || \\\"0\\\"))} earned`}\\n          color={COLORS.gold}\\n        /\u003e\\n        \u003cdiv style={{ display: \\\"flex\\\", justifyContent: \\\"space-between\\\", fontSize: 13 }}\u003e\\n          \u003cspan style={{ color: \\\"#6B7A90\\\" }}\u003eCustody\u003c/span\u003e\\n          {rel.isBlind ? (\\n            \u003cspan className=\\\"bg-[#059669]/15 text-[#059669] rounded-full px-2 py-0.5 text-[10px] font-bold uppercase tracking-wider\\\"\u003eCustodied\u003c/span\u003e\\n          ) : (\\n            \u003cspan className=\\\"bg-[#F59E0B]/15 text-[#F59E0B] rounded-full px-2 py-0.5 text-[10px] font-bold uppercase tracking-wider\\\"\u003eOpen\u003c/span\u003e\\n          )}\\n        \u003c/div\u003e\\n      \u003c/div\u003e\\n\\n      {/* Custody Hash */}\\n      {isFirst ? (\\n        \u003cGlowingBorder color=\\\"#C4972A\\\"\u003e\\n          \u003cCustodyHashRow hash={rel.timestampHash} onCopy={onCopyHash} /\u003e\\n        \u003c/GlowingBorder\u003e\\n      ) : (\\n        \u003cCustodyHashRow hash={rel.timestampHash} onCopy={onCopyHash} /\u003e\\n      )}\\n\\n      {/* E30: Mini timeline */}\\n      \u003cdiv style={{ display: \\\"flex\\\", alignItems: \\\"center\\\", gap: 4, marginTop: 12, paddingTop: 12, borderTop: `1px solid ${COLORS.border}` }}\u003e\\n        {timelineSteps.map((step, i) =\u003e (\\n          \u003cdiv key={step.label} style={{ display: \\\"flex\\\", alignItems: \\\"center\\\", flex: 1 }}\u003e\\n            \u003cdiv\\n              title={step.label}\\n              style={{\\n                width: 8,\\n                height: 8,\\n                borderRadius: \\\"50%\\\",\\n                background: step.done ? COLORS.green : COLORS.border,\\n                border: `2px solid ${step.done ? COLORS.green : COLORS.border}`,\\n                flexShrink: 0,\\n              }}\\n            /\u003e\\n            {i \u003c timelineSteps.length - 1 && (\\n              \u003cdiv style={{ flex: 1, height: 1, background: step.done ? COLORS.green : COLORS.border, marginLeft: 2, marginRight: 2 }} /\u003e\\n            )}\\n          \u003c/div\u003e\\n        ))}\\n        \u003cspan style={{ fontSize: 10, color: \\\"#94A3B8\\\", marginLeft: 4, whiteSpace: \\\"nowrap\\\" }}\u003e\\n          {timelineSteps.filter(s =\u003e s.done).length}/{timelineSteps.length}\\n        \u003c/span\u003e\\n      \u003c/div\u003e\\n\\n      {/* E27: View Receipt button */}\\n      \u003cbutton\\n        onClick={(e) =\u003e { e.stopPropagation(); setFlipped(true); }}\\n        style={{\\n          marginTop: 8,\\n          width: \\\"100%\\\",\\n          height: 32,\\n          borderRadius: 8,\\n          border: `1px solid ${COLORS.border}`,\\n          background: \\\"#fff\\\",\\n          color: COLORS.blue,\\n          fontWeight: 600,\\n          fontSize: 12,\\n          cursor: \\\"pointer\\\",\\n        }}\\n      \u003e\\n        View Receipt →\\n      \u003c/button\u003e\\n    \u003c/div\u003e\\n  );\\n}\\n\\nfunction CustodyHashRow({ hash, onCopy }: { hash: string; onCopy: (h: string) =\u003e void }) {\\n  return (\\n    \u003cdiv\\n      style={{\\n        background: COLORS.surface,\\n        borderRadius: 8,\\n        padding: \\\"10px 12px\\\",\\n        display: \\\"flex\\\",\\n        alignItems: \\\"center\\\",\\n        justifyContent: \\\"space-between\\\",\\n        gap: 8,\\n      }}\\n    \u003e\\n      \u003cspan className=\\\"font-data-mono text-[10px] text-[#1E3A5F]/50\\\" style={{ overflow: \\\"hidden\\\", textOverflow: \\\"ellipsis\\\", whiteSpace: \\\"nowrap\\\" }}\u003e\\n        Custody Proof: {hash?.slice(0, 8)}...{hash?.slice(-6)}\\n      \u003c/span\u003e\\n      \u003cbutton\\n        onClick={(e) =\u003e {\\n          e.stopPropagation();\\n          onCopy(hash);\\n        }}\\n        style={{\\n          background: \\\"none\\\",\\n          border: \\\"none\\\",\\n          cursor: \\\"pointer\\\",\\n          color: COLORS.blue,\\n          flexShrink: 0,\\n          display: \\\"flex\\\",\\n          alignItems: \\\"center\\\",\\n        }}\\n      \u003e\\n        \u003cCopy size={14} /\u003e\\n      \u003c/button\u003e\\n    \u003c/div\u003e\\n  );\\n}\\n\\nfunction Pill({ children, color }: { children: React.ReactNode; color: string }) {\\n  return (\\n    \u003cspan\\n      style={{\\n        fontSize: 12,\\n        fontWeight: 600,\\n        padding: \\\"4px 12px\\\",\\n        borderRadius: 6,\\n        background: `${color}10`,\\n        color,\\n      }}\\n    \u003e\\n      {children}\\n    \u003c/span\u003e\\n  );\\n}\\n\\nfunction StatusItem({ label, value, color }: { label: string; value: string; color: string }) {\\n  return (\\n    \u003cdiv style={{ display: \\\"flex\\\", justifyContent: \\\"space-between\\\", fontSize: 13 }}\u003e\\n      \u003cspan style={{ color: \\\"#6B7A90\\\" }}\u003e{label}\u003c/span\u003e\\n      \u003cspan style={{ fontWeight: 600, color }}\u003e{value}\u003c/span\u003e\\n    \u003c/div\u003e\\n  );\\n}\\n\\nfunction RelationshipTable({ relationships, onCopyHash, onExportProof, onSelect }: { relationships: any[]; onCopyHash: (h: string) =\u003e void; onExportProof?: (id: number) =\u003e void; onSelect?: (id: number) =\u003e void }) {\\n  return (\\n    \u003cdiv className=\\\"card-elevated\\\" style={{ overflow: \\\"hidden\\\" }}\u003e\\n      \u003ctable style={{ width: \\\"100%\\\", borderCollapse: \\\"collapse\\\", fontSize: 14 }}\u003e\\n        \u003cthead\u003e\\n          \u003ctr style={{ background: COLORS.surface }}\u003e\\n            {[\\\"ID\\\", \\\"Type\\\", \\\"Sector\\\", \\\"Custody Date\\\", \\\"Match Status\\\", \\\"Attribution\\\", \\\"Actions\\\"].map((h) =\u003e (\\n              \u003cth\\n                key={h}\\n                style={{\\n                  padding: \\\"12px 16px\\\",\\n                  textAlign: \\\"left\\\",\\n                  fontWeight: 600,\\n                  fontSize: 12,\\n                  textTransform: \\\"uppercase\\\" as const,\\n                  letterSpacing: \\\"0.05em\\\",\\n                  color: \\\"#6B7A90\\\",\\n                  borderBottom: `1px solid ${COLORS.border}`,\\n                }}\\n              \u003e\\n                {h}\\n              \u003c/th\u003e\\n            ))}\\n          \u003c/tr\u003e\\n        \u003c/thead\u003e\\n        \u003ctbody\u003e\\n          {relationships.map((rel) =\u003e {\\n            const isActive = (rel.dealCount || 0) \u003e 0;\\n            return (\\n              \u003ctr key={rel.id} onClick={() =\u003e onSelect?.(rel.id)} style={{ borderBottom: `1px solid ${COLORS.border}`, cursor: \\\"pointer\\\" }} className=\\\"hover:bg-[#F3F7FC] transition-colors\\\"\u003e\\n                \u003ctd style={{ padding: \\\"14px 16px\\\", fontFamily: \\\"monospace\\\", fontWeight: 600, color: COLORS.navy }}\u003e\\n                  REL-{rel.id}\\n                \u003c/td\u003e\\n                \u003ctd style={{ padding: \\\"14px 16px\\\", color: COLORS.navy }}\u003e\\n                  {(rel.relationshipType || \\\"direct\\\").charAt(0).toUpperCase() + (rel.relationshipType || \\\"direct\\\").slice(1)}\\n                \u003c/td\u003e\\n                \u003ctd style={{ padding: \\\"14px 16px\\\", color: \\\"#6B7A90\\\" }}\u003e{rel.tags?.[0] || \\\"—\\\"}\u003c/td\u003e\\n                \u003ctd style={{ padding: \\\"14px 16px\\\", color: \\\"#6B7A90\\\" }}\u003e\\n                  {new Date(rel.createdAt).toLocaleDateString(\\\"en-US\\\", { month: \\\"short\\\", day: \\\"numeric\\\", year: \\\"numeric\\\" })}\\n                \u003c/td\u003e\\n                \u003ctd style={{ padding: \\\"14px 16px\\\" }}\u003e\\n                  \u003cspan style={{ color: isActive ? COLORS.green : \\\"#94A3B8\\\", fontWeight: 600 }}\u003e\\n                    {isActive ? \\\"Active\\\" : \\\"Dormant\\\"}\\n                  \u003c/span\u003e\\n                \u003c/td\u003e\\n                \u003ctd style={{ padding: \\\"14px 16px\\\", fontWeight: 600, color: COLORS.gold }}\u003e\\n                  {formatCurrency(parseFloat(rel.totalEarnings || \\\"0\\\"))}\\n                \u003c/td\u003e\\n                \u003ctd style={{ padding: \\\"14px 16px\\\" }}\u003e\\n                  \u003cdiv style={{ display: \\\"flex\\\", gap: 12 }}\u003e\\n                    \u003cbutton\\n                      onClick={() =\u003e onCopyHash(rel.timestampHash)}\\n                      style={{\\n                        background: \\\"none\\\",\\n                        border: \\\"none\\\",\\n                        cursor: \\\"pointer\\\",\\n                        color: COLORS.blue,\\n                        display: \\\"flex\\\",\\n                        alignItems: \\\"center\\\",\\n                        gap: 4,\\n                        fontSize: 13,\\n                        fontWeight: 500,\\n                      }}\\n                    \u003e\\n                      \u003cCopy size={14} /\u003e Copy Hash\\n                    \u003c/button\u003e\\n                    {onExportProof && (\\n                      \u003cbutton\\n                        onClick={() =\u003e onExportProof(rel.id)}\\n                        style={{\\n                          background: \\\"none\\\",\\n                          border: \\\"none\\\",\\n                          cursor: \\\"pointer\\\",\\n                          color: COLORS.blue,\\n                          display: \\\"flex\\\",\\n                          alignItems: \\\"center\\\",\\n                          gap: 4,\\n                          fontSize: 13,\\n                          fontWeight: 500,\\n                        }}\\n                      \u003e\\n                        Export Proof\\n                      \u003c/button\u003e\\n                    )}\\n                  \u003c/div\u003e\\n                \u003c/td\u003e\\n              \u003c/tr\u003e\\n            );\\n          })}\\n        \u003c/tbody\u003e\\n      \u003c/table\u003e\\n    \u003c/div\u003e\\n  );\\n}\\n\\n/* -------------------------------------------------------------------------\\n   Relationship Detail Panel (Sheet)\\n   ------------------------------------------------------------------------- */\\n\\nfunction RelationshipDetailPanel({ relationshipId, onClose }: { relationshipId: number; onClose: () =\u003e void }) {\\n  const utils = trpc.useUtils();\\n  const { data: rel, isLoading } = trpc.relationship.get.useQuery(\\n    { id: relationshipId },\\n    { enabled: !!relationshipId },\\n  );\\n\\n  const { data: contacts, refetch: refetchContacts } = trpc.contact.getByRelationship.useQuery(\\n    { relationshipId },\\n    { enabled: !!relationshipId },\\n  );\\n\\n  const [editNotes, setEditNotes] = useState(\\\"\\\");\\n  const [editStrength, setEditStrength] = useState(\\\"\\\");\\n  const [notesDirty, setNotesDirty] = useState(false);\\n  const [contactForm, setContactForm] = useState({ displayName: \\\"\\\", platform: \\\"email\\\" as string, handle: \\\"\\\" });\\n  const [showContactForm, setShowContactForm] = useState(false);\\n\\n  useEffect(() =\u003e {\\n    if (rel) {\\n      setEditNotes(rel.notes || \\\"\\\");\\n      setEditStrength(rel.strength || \\\"moderate\\\");\\n      setNotesDirty(false);\\n    }\\n  }, [rel]);\\n\\n  const updateMutation = trpc.relationship.update.useMutation({\\n    onSuccess: () =\u003e {\\n      toast.success(\\\"Relationship updated\\\");\\n      utils.relationship.get.invalidate({ id: relationshipId });\\n      utils.relationship.list.invalidate();\\n    },\\n    onError: (e) =\u003e toast.error(e.message),\\n  });\\n\\n  const grantConsentMutation = trpc.relationship.grantConsent.useMutation({\\n    onSuccess: () =\u003e {\\n      toast.success(\\\"Consent granted — relationship is now fully visible\\\");\\n      utils.relationship.get.invalidate({ id: relationshipId });\\n      utils.relationship.list.invalidate();\\n    },\\n    onError: (e) =\u003e toast.error(e.message),\\n  });\\n\\n  const addContactMutation = trpc.contact.add.useMutation({\\n    onSuccess: () =\u003e {\\n      toast.success(\\\"Contact added\\\");\\n      refetchContacts();\\n      setContactForm({ displayName: \\\"\\\", platform: \\\"email\\\", handle: \\\"\\\" });\\n      setShowContactForm(false);\\n    },\\n    onError: (e) =\u003e toast.error(e.message),\\n  });\\n\\n  if (isLoading) {\\n    return (\\n      \u003cdiv className=\\\"py-12 flex items-center justify-center\\\"\u003e\\n        \u003cLoader2 className=\\\"w-6 h-6 animate-spin\\\" style={{ color: COLORS.blue }} /\u003e\\n      \u003c/div\u003e\\n    );\\n  }\\n\\n  if (!rel) {\\n    return \u003cp className=\\\"py-8 text-center text-muted-foreground text-sm\\\"\u003eRelationship not found\u003c/p\u003e;\\n  }\\n\\n  return (\\n    \u003cdiv className=\\\"space-y-6 pt-2\\\"\u003e\\n      \u003cSheetHeader\u003e\\n        \u003cSheetTitle className=\\\"text-lg\\\" style={{ color: COLORS.navy }}\u003e\\n          REL-{rel.id}\\n        \u003c/SheetTitle\u003e\\n        \u003cSheetDescription\u003e\\n          {(rel.relationshipType || \\\"direct\\\").charAt(0).toUpperCase() + (rel.relationshipType || \\\"direct\\\").slice(1)} relationship\\n        \u003c/SheetDescription\u003e\\n      \u003c/SheetHeader\u003e\\n\\n      {/* Metadata */}\\n      \u003csection className=\\\"space-y-3\\\"\u003e\\n        \u003cDetailRow label=\\\"Type\\\" value={(rel.relationshipType || \\\"direct\\\").charAt(0).toUpperCase() + (rel.relationshipType || \\\"direct\\\").slice(1)} /\u003e\\n        \u003cDetailRow label=\\\"Status\\\" value={rel.isBlind ? \\\"Custodied (Blind)\\\" : \\\"Open\\\"} /\u003e\\n        \u003cDetailRow label=\\\"Custody Timestamp\\\" value={new Date(rel.createdAt).toLocaleString()} /\u003e\\n        \u003cDetailRow label=\\\"Established\\\" value={rel.establishedAt ? new Date(rel.establishedAt).toLocaleDateString() : \\\"—\\\"} /\u003e\\n        {rel.tags && rel.tags.length \u003e 0 && (\\n          \u003cdiv className=\\\"flex items-center justify-between text-sm\\\"\u003e\\n            \u003cspan style={{ color: \\\"#6B7A90\\\" }}\u003eTags\u003c/span\u003e\\n            \u003cdiv className=\\\"flex gap-1 flex-wrap justify-end\\\"\u003e\\n              {rel.tags.map((t: string) =\u003e (\\n                \u003cspan key={t} className=\\\"px-2 py-0.5 rounded-full text-[11px] font-medium\\\" style={{ background: `${COLORS.blue}10`, color: COLORS.blue }}\u003e\\n                  {t}\\n                \u003c/span\u003e\\n              ))}\\n            \u003c/div\u003e\\n          \u003c/div\u003e\\n        )}\\n      \u003c/section\u003e\\n\\n      {/* Grant Consent */}\\n      {rel.isBlind && (\\n        \u003cbutton\\n          onClick={() =\u003e grantConsentMutation.mutate({ id: relationshipId })}\\n          disabled={grantConsentMutation.isPending}\\n          className=\\\"w-full flex items-center justify-center gap-2 h-10 rounded-lg text-sm font-semibold text-white transition-colors disabled:opacity-50\\\"\\n          style={{ background: COLORS.green }}\\n        \u003e\\n          {grantConsentMutation.isPending ? (\\n            \u003c\u003e\u003cLoader2 className=\\\"w-4 h-4 animate-spin\\\" /\u003e Granting...\u003c/\u003e\\n          ) : (\\n            \u003c\u003e\u003cShieldCheck className=\\\"w-4 h-4\\\" /\u003e Grant Consent\u003c/\u003e\\n          )}\\n        \u003c/button\u003e\\n      )}\\n\\n      {/* Inline Editing: Strength */}\\n      \u003csection\u003e\\n        \u003clabel className=\\\"block text-xs font-semibold mb-1.5\\\" style={{ color: COLORS.navy }}\u003eStrength\u003c/label\u003e\\n        \u003cselect\\n          value={editStrength}\\n          onChange={(e) =\u003e {\\n            setEditStrength(e.target.value);\\n            updateMutation.mutate({\\n              id: relationshipId,\\n              strength: e.target.value as any,\\n            });\\n          }}\\n          className=\\\"w-full h-9 px-3 rounded-lg border text-sm\\\"\\n          style={{ borderColor: COLORS.border, color: COLORS.navy }}\\n        \u003e\\n          \u003coption value=\\\"weak\\\"\u003eWeak\u003c/option\u003e\\n          \u003coption value=\\\"moderate\\\"\u003eModerate\u003c/option\u003e\\n          \u003coption value=\\\"strong\\\"\u003eStrong\u003c/option\u003e\\n          \u003coption value=\\\"very_strong\\\"\u003eVery Strong\u003c/option\u003e\\n        \u003c/select\u003e\\n      \u003c/section\u003e\\n\\n      {/* Inline Editing: Notes */}\\n      \u003csection\u003e\\n        \u003clabel className=\\\"block text-xs font-semibold mb-1.5\\\" style={{ color: COLORS.navy }}\u003eNotes\u003c/label\u003e\\n        \u003ctextarea\\n          value={editNotes}\\n          onChange={(e) =\u003e { setEditNotes(e.target.value); setNotesDirty(true); }}\\n          className=\\\"w-full rounded-lg border p-3 text-sm resize-none focus:outline-none focus:ring-2\\\"\\n          style={{ borderColor: COLORS.border, minHeight: 80 }}\\n          placeholder=\\\"Add notes...\\\"\\n        /\u003e\\n        {notesDirty && (\\n          \u003cbutton\\n            onClick={() =\u003e {\\n              updateMutation.mutate({ id: relationshipId, notes: editNotes });\\n              setNotesDirty(false);\\n            }}\\n            disabled={updateMutation.isPending}\\n            className=\\\"mt-2 inline-flex items-center gap-1.5 px-3 py-1.5 rounded-lg text-xs font-semibold text-white disabled:opacity-50\\\"\\n            style={{ background: COLORS.blue }}\\n          \u003e\\n            {updateMutation.isPending ? \u003cLoader2 className=\\\"w-3 h-3 animate-spin\\\" /\u003e : \u003cSave className=\\\"w-3 h-3\\\" /\u003e}\\n            Save Notes\\n          \u003c/button\u003e\\n        )}\\n      \u003c/section\u003e\\n\\n      {/* Contacts */}\\n      \u003csection\u003e\\n        \u003cdiv className=\\\"flex items-center justify-between mb-3\\\"\u003e\\n          \u003ch4 className=\\\"text-sm font-semibold\\\" style={{ color: COLORS.navy }}\u003eContacts\u003c/h4\u003e\\n          \u003cbutton\\n            onClick={() =\u003e setShowContactForm(!showContactForm)}\\n            className=\\\"inline-flex items-center gap-1 text-xs font-semibold\\\"\\n            style={{ color: COLORS.blue }}\\n          \u003e\\n            \u003cUserPlus className=\\\"w-3.5 h-3.5\\\" /\u003e\\n            Add\\n          \u003c/button\u003e\\n        \u003c/div\u003e\\n\\n        {contacts && contacts.length \u003e 0 ? (\\n          \u003cdiv className=\\\"space-y-2\\\"\u003e\\n            {contacts.map((c: any) =\u003e (\\n              \u003cdiv key={c.id} className=\\\"flex items-center gap-3 p-2.5 rounded-lg\\\" style={{ background: COLORS.surface }}\u003e\\n                \u003cContactIcon platform={c.platform} /\u003e\\n                \u003cdiv className=\\\"flex-1 min-w-0\\\"\u003e\\n                  \u003cp className=\\\"text-sm font-medium truncate\\\" style={{ color: COLORS.navy }}\u003e\\n                    {c.displayName || c.handle}\\n                  \u003c/p\u003e\\n                  \u003cp className=\\\"text-xs text-muted-foreground truncate\\\"\u003e\\n                    {c.platform} · {c.handle}\\n                  \u003c/p\u003e\\n                \u003c/div\u003e\\n              \u003c/div\u003e\\n            ))}\\n          \u003c/div\u003e\\n        ) : (\\n          \u003cp className=\\\"text-xs text-muted-foreground\\\"\u003eNo contacts linked yet.\u003c/p\u003e\\n        )}\\n\\n        {showContactForm && (\\n          \u003cdiv className=\\\"mt-3 p-3 rounded-lg border space-y-2.5\\\" style={{ borderColor: COLORS.border }}\u003e\\n            \u003cinput\\n              type=\\\"text\\\"\\n              placeholder=\\\"Display name\\\"\\n              value={contactForm.displayName}\\n              onChange={(e) =\u003e setContactForm({ ...contactForm, displayName: e.target.value })}\\n              className=\\\"w-full h-8 px-3 rounded border text-sm\\\"\\n              style={{ borderColor: COLORS.border }}\\n            /\u003e\\n            \u003cselect\\n              value={contactForm.platform}\\n              onChange={(e) =\u003e setContactForm({ ...contactForm, platform: e.target.value })}\\n              className=\\\"w-full h-8 px-3 rounded border text-sm\\\"\\n              style={{ borderColor: COLORS.border, color: COLORS.navy }}\\n            \u003e\\n              \u003coption value=\\\"email\\\"\u003eEmail\u003c/option\u003e\\n              \u003coption value=\\\"phone\\\"\u003ePhone\u003c/option\u003e\\n              \u003coption value=\\\"linkedin\\\"\u003eLinkedIn\u003c/option\u003e\\n              \u003coption value=\\\"telegram\\\"\u003eTelegram\u003c/option\u003e\\n              \u003coption value=\\\"discord\\\"\u003eDiscord\u003c/option\u003e\\n              \u003coption value=\\\"whatsapp\\\"\u003eWhatsApp\u003c/option\u003e\\n              \u003coption value=\\\"twitter\\\"\u003eTwitter\u003c/option\u003e\\n              \u003coption value=\\\"other\\\"\u003eOther\u003c/option\u003e\\n            \u003c/select\u003e\\n            \u003cinput\\n              type=\\\"text\\\"\\n              placeholder=\\\"Handle / value\\\"\\n              value={contactForm.handle}\\n              onChange={(e) =\u003e setContactForm({ ...contactForm, handle: e.target.value })}\\n              className=\\\"w-full h-8 px-3 rounded border text-sm\\\"\\n              style={{ borderColor: COLORS.border }}\\n            /\u003e\\n            \u003cbutton\\n              onClick={() =\u003e {\\n                if (!contactForm.handle) { toast.error(\\\"Handle is required\\\"); return; }\\n                addContactMutation.mutate({\\n                  platform: contactForm.platform as any,\\n                  handle: contactForm.handle,\\n                  displayName: contactForm.displayName || undefined,\\n                });\\n              }}\\n              disabled={addContactMutation.isPending}\\n              className=\\\"w-full h-8 rounded-lg text-xs font-semibold text-white disabled:opacity-50\\\"\\n              style={{ background: COLORS.gold }}\\n            \u003e\\n              {addContactMutation.isPending ? \\\"Adding...\\\" : \\\"Add Contact\\\"}\\n            \u003c/button\u003e\\n          \u003c/div\u003e\\n        )}\\n      \u003c/section\u003e\\n    \u003c/div\u003e\\n  );\\n}\\n\\nfunction DetailRow({ label, value }: { label: string; value: string }) {\\n  return (\\n    \u003cdiv className=\\\"flex items-center justify-between text-sm\\\"\u003e\\n      \u003cspan style={{ color: \\\"#6B7A90\\\" }}\u003e{label}\u003c/span\u003e\\n      \u003cspan className=\\\"font-medium\\\" style={{ color: COLORS.navy }}\u003e{value}\u003c/span\u003e\\n    \u003c/div\u003e\\n  );\\n}\\n\\nfunction ContactIcon({ platform }: { platform: string }) {\\n  const cls = \\\"w-4 h-4\\\";\\n  const style = { color: COLORS.blue };\\n  switch (platform) {\\n    case \\\"email\\\": return \u003cMail className={cls} style={style} /\u003e;\\n    case \\\"phone\\\": return \u003cPhone className={cls} style={style} /\u003e;\\n    case \\\"linkedin\\\": return \u003cLinkedin className={cls} style={style} /\u003e;\\n    default: return \u003cUsers className={cls} style={style} /\u003e;\\n  }\\n}\\n\\n/* -------------------------------------------------------------------------\\n   Modal Steps\\n   ------------------------------------------------------------------------- */\\n\\nfunction ModalStepType({ selected, onSelect }: { selected: string; onSelect: (v: string) =\u003e void }) {\\n  return (\\n    \u003cdiv\u003e\\n      \u003ch3 style={{ fontSize: 16, fontWeight: 600, color: COLORS.navy, marginBottom: 4 }}\u003eRelationship Type\u003c/h3\u003e\\n      \u003cp style={{ fontSize: 13, color: \\\"#6B7A90\\\", marginBottom: 20 }}\u003eSelect the type of relationship you want to protect.\u003c/p\u003e\\n      \u003cdiv style={{ display: \\\"grid\\\", gridTemplateColumns: \\\"1fr 1fr\\\", gap: 12 }}\u003e\\n        {REL_TYPES.map((t) =\u003e {\\n          const Icon = t.icon;\\n          const isSelected = selected === t.value;\\n          return (\\n            \u003cbutton\\n              key={t.value}\\n              onClick={() =\u003e onSelect(t.value)}\\n              style={{\\n                padding: 16,\\n                borderRadius: 10,\\n                border: `2px solid ${isSelected ? COLORS.gold : COLORS.border}`,\\n                background: isSelected ? `${COLORS.gold}08` : \\\"#fff\\\",\\n                cursor: \\\"pointer\\\",\\n                display: \\\"flex\\\",\\n                alignItems: \\\"center\\\",\\n                gap: 12,\\n                textAlign: \\\"left\\\",\\n              }}\\n            \u003e\\n              \u003cdiv\\n                style={{\\n                  width: 40,\\n                  height: 40,\\n                  borderRadius: 10,\\n                  background: isSelected ? COLORS.gold : COLORS.surface,\\n                  display: \\\"flex\\\",\\n                  alignItems: \\\"center\\\",\\n                  justifyContent: \\\"center\\\",\\n                }}\\n              \u003e\\n                \u003cIcon size={18} style={{ color: isSelected ? \\\"#fff\\\" : \\\"#6B7A90\\\" }} /\u003e\\n              \u003c/div\u003e\\n              \u003cspan style={{ fontWeight: 600, fontSize: 14, color: COLORS.navy }}\u003e{t.label}\u003c/span\u003e\\n              {isSelected && \u003cCheck size={16} style={{ marginLeft: \\\"auto\\\", color: COLORS.gold }} /\u003e}\\n            \u003c/button\u003e\\n          );\\n        })}\\n      \u003c/div\u003e\\n    \u003c/div\u003e\\n  );\\n}\\n\\nfunction ModalStepProfile({\\n  sectors, onSectorsChange,\\n  dealMin, dealMax, onDealMinChange, onDealMaxChange,\\n  regions, onRegionsChange,\\n  requirements, onRequirementsChange,\\n}: {\\n  sectors: string[]; onSectorsChange: (v: string[]) =\u003e void;\\n  dealMin: string; dealMax: string; onDealMinChange: (v: string) =\u003e void; onDealMaxChange: (v: string) =\u003e void;\\n  regions: string[]; onRegionsChange: (v: string[]) =\u003e void;\\n  requirements: string; onRequirementsChange: (v: string) =\u003e void;\\n}) {\\n  const toggleChip = (list: string[], setter: (v: string[]) =\u003e void, val: string) =\u003e {\\n    setter(list.includes(val) ? list.filter((v) =\u003e v !== val) : [...list, val]);\\n  };\\n\\n  return (\\n    \u003cdiv\u003e\\n      \u003ch3 style={{ fontSize: 16, fontWeight: 600, color: COLORS.navy, marginBottom: 4 }}\u003eDeal Profile\u003c/h3\u003e\\n      \u003cp style={{ fontSize: 13, color: \\\"#6B7A90\\\", marginBottom: 20 }}\u003eDefine the deal profile for this relationship.\u003c/p\u003e\\n\\n      \u003cFieldLabel\u003eSector\u003c/FieldLabel\u003e\\n      \u003cdiv style={{ display: \\\"flex\\\", flexWrap: \\\"wrap\\\", gap: 8, marginBottom: 20 }}\u003e\\n        {SECTORS.map((s) =\u003e (\\n          \u003cChipButton key={s} active={sectors.includes(s)} onClick={() =\u003e toggleChip(sectors, onSectorsChange, s)}\u003e\\n            {s}\\n          \u003c/ChipButton\u003e\\n        ))}\\n      \u003c/div\u003e\\n\\n      \u003cFieldLabel\u003eDeal Size Range\u003c/FieldLabel\u003e\\n      \u003cdiv style={{ display: \\\"flex\\\", gap: 12, marginBottom: 20 }}\u003e\\n        \u003cinput\\n          type=\\\"text\\\"\\n          placeholder=\\\"Min ($)\\\"\\n          value={dealMin}\\n          onChange={(e) =\u003e onDealMinChange(e.target.value)}\\n          style={inputStyle}\\n        /\u003e\\n        \u003cinput\\n          type=\\\"text\\\"\\n          placeholder=\\\"Max ($)\\\"\\n          value={dealMax}\\n          onChange={(e) =\u003e onDealMaxChange(e.target.value)}\\n          style={inputStyle}\\n        /\u003e\\n      \u003c/div\u003e\\n\\n      \u003cFieldLabel\u003eGeographic Focus\u003c/FieldLabel\u003e\\n      \u003cdiv style={{ display: \\\"flex\\\", flexWrap: \\\"wrap\\\", gap: 8, marginBottom: 20 }}\u003e\\n        {REGIONS.map((r) =\u003e (\\n          \u003cChipButton key={r} active={regions.includes(r)} onClick={() =\u003e toggleChip(regions, onRegionsChange, r)}\u003e\\n            {r}\\n          \u003c/ChipButton\u003e\\n        ))}\\n      \u003c/div\u003e\\n\\n      \u003cFieldLabel\u003eSpecific Requirements\u003c/FieldLabel\u003e\\n      \u003ctextarea\\n        rows={3}\\n        placeholder=\\\"Add any specific requirements...\\\"\\n        value={requirements}\\n        onChange={(e) =\u003e onRequirementsChange(e.target.value)}\\n        style={{ ...inputStyle, height: \\\"auto\\\", resize: \\\"vertical\\\" as const, padding: 12 }}\\n      /\u003e\\n    \u003c/div\u003e\\n  );\\n}\\n\\nfunction ModalStepVerification({ level, onLevelChange }: { level: string; onLevelChange: (v: string) =\u003e void }) {\\n  return (\\n    \u003cdiv\u003e\\n      \u003ch3 style={{ fontSize: 16, fontWeight: 600, color: COLORS.navy, marginBottom: 4 }}\u003eVerification Level\u003c/h3\u003e\\n      \u003cp style={{ fontSize: 13, color: \\\"#6B7A90\\\", marginBottom: 20 }}\u003eWhat level of verification can you provide?\u003c/p\u003e\\n\\n      \u003cFieldLabel\u003eWhat can you confirm?\u003c/FieldLabel\u003e\\n      \u003cdiv style={{ position: \\\"relative\\\", marginBottom: 20 }}\u003e\\n        \u003cselect\\n          value={level}\\n          onChange={(e) =\u003e onLevelChange(e.target.value)}\\n          style={{\\n            ...inputStyle,\\n            appearance: \\\"none\\\",\\n            paddingRight: 36,\\n            cursor: \\\"pointer\\\",\\n            color: level ? COLORS.navy : \\\"#94A3B8\\\",\\n          }}\\n        \u003e\\n          \u003coption value=\\\"\\\"\u003eSelect verification level\u003c/option\u003e\\n          {VERIFICATION_LEVELS.map((v) =\u003e (\\n            \u003coption key={v} value={v}\u003e{v}\u003c/option\u003e\\n          ))}\\n        \u003c/select\u003e\\n        \u003cChevronDown\\n          size={14}\\n          style={{ position: \\\"absolute\\\", right: 12, top: \\\"50%\\\", transform: \\\"translateY(-50%)\\\", pointerEvents: \\\"none\\\", color: \\\"#94A3B8\\\" }}\\n        /\u003e\\n      \u003c/div\u003e\\n\\n      \u003cFieldLabel\u003eDocument Upload (Optional)\u003c/FieldLabel\u003e\\n      \u003cdiv\\n        style={{\\n          border: `2px dashed ${COLORS.border}`,\\n          borderRadius: 10,\\n          padding: \\\"32px 16px\\\",\\n          textAlign: \\\"center\\\",\\n          color: \\\"#94A3B8\\\",\\n          cursor: \\\"pointer\\\",\\n        }}\\n      \u003e\\n        \u003cUpload size={28} style={{ margin: \\\"0 auto 8px\\\", display: \\\"block\\\" }} /\u003e\\n        \u003cdiv style={{ fontSize: 14, fontWeight: 500 }}\u003eDrop files here or click to upload\u003c/div\u003e\\n        \u003cdiv style={{ fontSize: 12, marginTop: 4 }}\u003ePDF, DOC, or images up to 10MB\u003c/div\u003e\\n      \u003c/div\u003e\\n    \u003c/div\u003e\\n  );\\n}\\n\\nfunction ModalStepCustody({\\n  exposure, onExposureChange,\\n  autoMatch, onAutoMatchChange,\\n}: {\\n  exposure: string; onExposureChange: (v: string) =\u003e void;\\n  autoMatch: boolean; onAutoMatchChange: (v: boolean) =\u003e void;\\n}) {\\n  const exposureOptions = [\\n    { value: \\\"full\\\", label: \\\"Full\\\", desc: \\\"Complete profile visible to matches\\\" },\\n    { value: \\\"sector-only\\\", label: \\\"Sector-only\\\", desc: \\\"Only sector and deal size visible\\\" },\\n    { value: \\\"hidden\\\", label: \\\"Hidden\\\", desc: \\\"No details shared until you approve\\\" },\\n  ];\\n\\n  return (\\n    \u003cdiv\u003e\\n      \u003ch3 style={{ fontSize: 16, fontWeight: 600, color: COLORS.navy, marginBottom: 4 }}\u003eCustody Settings\u003c/h3\u003e\\n      \u003cp style={{ fontSize: 13, color: \\\"#6B7A90\\\", marginBottom: 20 }}\u003eControl how your relationship data is shared.\u003c/p\u003e\\n\\n      \u003cFieldLabel\u003eMatch Exposure\u003c/FieldLabel\u003e\\n      \u003cdiv style={{ display: \\\"flex\\\", flexDirection: \\\"column\\\", gap: 10, marginBottom: 24 }}\u003e\\n        {exposureOptions.map((opt) =\u003e (\\n          \u003clabel\\n            key={opt.value}\\n            style={{\\n              display: \\\"flex\\\",\\n              alignItems: \\\"center\\\",\\n              gap: 12,\\n              padding: \\\"12px 16px\\\",\\n              borderRadius: 10,\\n              border: `2px solid ${exposure === opt.value ? COLORS.gold : COLORS.border}`,\\n              background: exposure === opt.value ? `${COLORS.gold}08` : \\\"#fff\\\",\\n              cursor: \\\"pointer\\\",\\n            }}\\n          \u003e\\n            \u003cinput\\n              type=\\\"radio\\\"\\n              name=\\\"exposure\\\"\\n              value={opt.value}\\n              checked={exposure === opt.value}\\n              onChange={(e) =\u003e onExposureChange(e.target.value)}\\n              style={{ accentColor: COLORS.gold }}\\n            /\u003e\\n            \u003cdiv\u003e\\n              \u003cdiv style={{ fontWeight: 600, fontSize: 14, color: COLORS.navy }}\u003e{opt.label}\u003c/div\u003e\\n              \u003cdiv style={{ fontSize: 12, color: \\\"#6B7A90\\\" }}\u003e{opt.desc}\u003c/div\u003e\\n            \u003c/div\u003e\\n          \u003c/label\u003e\\n        ))}\\n      \u003c/div\u003e\\n\\n      \u003cdiv\\n        style={{\\n          display: \\\"flex\\\",\\n          alignItems: \\\"center\\\",\\n          justifyContent: \\\"space-between\\\",\\n          padding: \\\"14px 16px\\\",\\n          borderRadius: 10,\\n          border: `1px solid ${COLORS.border}`,\\n          marginBottom: 24,\\n        }}\\n      \u003e\\n        \u003cdiv\u003e\\n          \u003cdiv style={{ fontWeight: 600, fontSize: 14, color: COLORS.navy }}\u003eAuto-match consent\u003c/div\u003e\\n          \u003cdiv style={{ fontSize: 12, color: \\\"#6B7A90\\\" }}\u003eAllow automatic matching with compatible deals\u003c/div\u003e\\n        \u003c/div\u003e\\n        \u003cbutton\\n          onClick={() =\u003e onAutoMatchChange(!autoMatch)}\\n          style={{\\n            width: 44,\\n            height: 24,\\n            borderRadius: 12,\\n            border: \\\"none\\\",\\n            background: autoMatch ? COLORS.green : \\\"#CBD5E1\\\",\\n            cursor: \\\"pointer\\\",\\n            position: \\\"relative\\\",\\n            transition: \\\"background 0.2s\\\",\\n          }}\\n        \u003e\\n          \u003cdiv\\n            style={{\\n              width: 18,\\n              height: 18,\\n              borderRadius: \\\"50%\\\",\\n              background: \\\"#fff\\\",\\n              position: \\\"absolute\\\",\\n              top: 3,\\n              left: autoMatch ? 23 : 3,\\n              transition: \\\"left 0.2s\\\",\\n              boxShadow: \\\"0 1px 3px rgba(0,0,0,0.2)\\\",\\n            }}\\n          /\u003e\\n        \u003c/button\u003e\\n      \u003c/div\u003e\\n\\n      \u003cdiv\\n        style={{\\n          padding: \\\"14px 16px\\\",\\n          borderRadius: 10,\\n          border: `1px solid ${COLORS.border}`,\\n          background: COLORS.surface,\\n        }}\\n      \u003e\\n        \u003cdiv style={{ fontWeight: 600, fontSize: 14, color: COLORS.navy, marginBottom: 4 }}\u003eAttribution Split\u003c/div\u003e\\n        \u003cdiv style={{ fontSize: 13, color: \\\"#6B7A90\\\" }}\u003e\\n          Team attribution splitting will be available for team accounts. Contact support to upgrade.\\n        \u003c/div\u003e\\n      \u003c/div\u003e\\n    \u003c/div\u003e\\n  );\\n}\\n\\nfunction ModalStepConfirmation({ id, hash, onDone }: { id: string; hash: string; onDone: () =\u003e void }) {\\n  const now = new Date().toLocaleString(\\\"en-US\\\", {\\n    month: \\\"long\\\",\\n    day: \\\"numeric\\\",\\n    year: \\\"numeric\\\",\\n    hour: \\\"numeric\\\",\\n    minute: \\\"2-digit\\\",\\n  });\\n\\n  return (\\n    \u003cdiv style={{ textAlign: \\\"center\\\", padding: \\\"12px 0\\\" }}\u003e\\n      \u003cdiv\\n        style={{\\n          width: 64,\\n          height: 64,\\n          borderRadius: \\\"50%\\\",\\n          background: `${COLORS.green}15`,\\n          display: \\\"flex\\\",\\n          alignItems: \\\"center\\\",\\n          justifyContent: \\\"center\\\",\\n          margin: \\\"0 auto 20px\\\",\\n        }}\\n      \u003e\\n        \u003cShield size={32} style={{ color: COLORS.green }} /\u003e\\n      \u003c/div\u003e\\n\\n      \u003ch3 style={{ fontSize: 20, fontWeight: 700, color: COLORS.navy, marginBottom: 8 }}\u003e\\n        {CUSTODY_RECEIPT.title}\\n      \u003c/h3\u003e\\n      \u003cp style={{ fontSize: 14, color: \\\"#6B7A90\\\", marginBottom: 28 }}\u003e{CUSTODY_RECEIPT.body}\u003c/p\u003e\\n\\n      \u003cdiv\\n        className=\\\"card-elevated\\\"\\n        style={{\\n          padding: 20,\\n          textAlign: \\\"left\\\",\\n          marginBottom: 28,\\n        }}\\n      \u003e\\n        \u003cReceiptRow label=\\\"Timestamp\\\" value={now} /\u003e\\n        \u003cReceiptRow label=\\\"Custody ID\\\" value={id} mono /\u003e\\n        \u003cReceiptRow label=\\\"Custody Proof\\\" value={hash.slice(0, 32) + \\\"...\\\"} mono last /\u003e\\n      \u003c/div\u003e\\n\\n      \u003cbutton\\n        onClick={onDone}\\n        style={{\\n          height: 44,\\n          padding: \\\"0 40px\\\",\\n          borderRadius: 8,\\n          background: COLORS.gold,\\n          color: \\\"#fff\\\",\\n          fontWeight: 600,\\n          fontSize: 15,\\n          border: \\\"none\\\",\\n          cursor: \\\"pointer\\\",\\n        }}\\n      \u003e\\n        Done\\n      \u003c/button\u003e\\n    \u003c/div\u003e\\n  );\\n}\\n\\nfunction ReceiptRow({ label, value, mono, last }: { label: string; value: string; mono?: boolean; last?: boolean }) {\\n  return (\\n    \u003cdiv\\n      style={{\\n        display: \\\"flex\\\",\\n        justifyContent: \\\"space-between\\\",\\n        padding: \\\"10px 0\\\",\\n        borderBottom: last ? \\\"none\\\" : `1px solid ${COLORS.border}`,\\n      }}\\n    \u003e\\n      \u003cspan style={{ fontSize: 13, color: \\\"#6B7A90\\\" }}\u003e{label}\u003c/span\u003e\\n      \u003cspan\\n        className={mono ? \\\"font-data-mono text-[10px] text-[#1E3A5F]/50 font-semibold\\\" : \\\"\\\"}\\n        style={!mono ? { fontSize: 13, fontWeight: 600, color: COLORS.navy } : undefined}\\n      \u003e\\n        {value}\\n      \u003c/span\u003e\\n    \u003c/div\u003e\\n  );\\n}\\n\\n/* -------------------------------------------------------------------------\\n   Shared UI Helpers\\n   ------------------------------------------------------------------------- */\\n\\nfunction FieldLabel({ children }: { children: React.ReactNode }) {\\n  return (\\n    \u003cdiv style={{ fontSize: 13, fontWeight: 600, color: COLORS.navy, marginBottom: 8 }}\u003e{children}\u003c/div\u003e\\n  );\\n}\\n\\nfunction ChipButton({ children, active, onClick }: { children: React.ReactNode; active: boolean; onClick: () =\u003e void }) {\\n  return (\\n    \u003cbutton\\n      onClick={onClick}\\n      style={{\\n        padding: \\\"6px 14px\\\",\\n        borderRadius: 20,\\n        border: `1px solid ${active ? COLORS.gold : COLORS.border}`,\\n        background: active ? `${COLORS.gold}15` : \\\"#fff\\\",\\n        color: active ? COLORS.gold : \\\"#6B7A90\\\",\\n        fontWeight: 500,\\n        fontSize: 13,\\n        cursor: \\\"pointer\\\",\\n      }}\\n    \u003e\\n      {children}\\n    \u003c/button\u003e\\n  );\\n}\\n\\nconst inputStyle: React.CSSProperties = {\\n  width: \\\"100%\\\",\\n  height: 42,\\n  padding: \\\"0 14px\\\",\\n  borderRadius: 8,\\n  border: `1px solid ${COLORS.border}`,\\n  background: \\\"#fff\\\",\\n  fontSize: 14,\\n  outline: \\\"none\\\",\\n  color: COLORS.navy,\\n};\\n\",\n  \"changes_summary\": [\n    \"Changed page heading from 'Relationships' to 'Relationship Custody' and added a subtitle: 'Timestamped introductions with cryptographic proof of custody.'\",\n    \"Updated filter options for 'Verification Status' from 'Protected' to 'Custodied' and 'Visible' to 'Open'.\",\n    \"Modified filtering logic in `filteredRelationships` to use 'custodied' and 'open' values.\",\n    \"Updated status badges on `RelationshipCard` and `RelationshipDetailPanel` from 'Protected' to 'Custodied' and 'Visible' to 'Open'.\",\n    \"Changed 'Hash' labels to 'Custody Proof' in `CustodyHashRow`, `ProofModal`, `RelationshipCard` (flipped state), and `ModalStepConfirmation`.\",\n    \"Applied `font-data-mono` class to hash values in `CustodyHashRow`, `ProofModal`, and `ReceiptRow` (used by `ModalStepConfirmation` and `RelationshipCard` flipped state).\",\n    \"Replaced hardcoded confirmation text in `ModalStepConfirmation` with `CUSTODY_RECEIPT.title` and `CUSTODY_RECEIPT.body`.\",\n    \"Changed the label for one of the 4-stat cards from 'TOTAL RELATIONSHIPS' to 'CUSTODIED RELATIONSHIPS'.\"\n  ],\n  \"whitepaper_terms_added\": [\n    \"Relationship Custody\",\n    \"Custodied\",\n    \"Open\",\n    \"Custody Proof\",\n    \"Timestamped introductions with cryptographic proof of custody.\"\n  ],\n  \"copy_tokens_used\": [\n    \"CUSTODY_RECEIPT.title\",\n    \"CUSTODY_RECEIPT.body\"\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 21439,
    "candidatesTokenCount": 19027,
    "totalTokenCount": 43438,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 21439
      }
    ],
    "thoughtsTokenCount": 2972
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "H-ihaZqiJ_SGz7IPuoj32AY"
}
