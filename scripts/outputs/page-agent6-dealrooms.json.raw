{
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"upgraded_tsx\": \"import { useState, useMemo, useEffect } from \\\"react\\\";\\nimport { trpc } from \\\"@/lib/trpc\\\";\\nimport { EmptyState, EMPTY_STATES } from \\\"@/components/EmptyState\\\";\\nimport {\\n  FolderOpen, Clock, ChevronRight,\\n  Lock, Download, Eye\\n} from \\\"lucide-react\\\";\\nimport { useLocation } from \\\"wouter\\\";\\nimport { FadeInView, ScaleHover, StaggerContainer, StaggerItem } from \\\"@/components/PageTransition\\\";\\n\\ntype StatusFilter = \\\"all\\\" | \\\"nda_pending\\\" | \\\"active\\\" | \\\"completed\\\" | \\\"declined\\\";\\n\\nconst STATUS_FILTERS: { key: StatusFilter; label: string; className: string }[] = [\\n  { key: \\\"all\\\", label: \\\"All\\\", className: \\\"\\\" },\\n  { key: \\\"nda_pending\\\", label: \\\"NDA Pending\\\", className: \\\"status-nda-pending\\\" },\\n  { key: \\\"active\\\", label: \\\"Active\\\", className: \\\"status-active\\\" },\\n  { key: \\\"completed\\\", label: \\\"Completed\\\", className: \\\"status-completed\\\" },\\n  { key: \\\"declined\\\", label: \\\"Declined\\\", className: \\\"status-declined\\\" },\\n];\\n\\nconst BADGE = \\\"rounded-full px-2 py-0.5 text-[10px] font-bold uppercase tracking-wider\\\";\\n\\nfunction getStatusClass(status: string | null): string {\\n  switch (status) {\\n    case \\\"active\\\":\\n      return `bg-[#22D4F5]/10 text-[#22D4F5]/80 ${BADGE}`;\\n    case \\\"closed\\\":\\n      return `bg-[#059669]/15 text-[#059669] ${BADGE}`;\\n    case \\\"archived\\\":\\n      return `bg-[#6B7280]/15 text-[#6B7280] ${BADGE}`;\\n    default:\\n      return `bg-[#F59E0B]/15 text-[#F59E0B] ${BADGE}`;\\n  }\\n}\\n\\nfunction getStatusLabel(status: string | null): string {\\n  switch (status) {\\n    case \\\"active\\\": return \\\"Active\\\";\\n    case \\\"closed\\\": return \\\"Completed\\\";\\n    case \\\"archived\\\": return \\\"Declined\\\";\\n    default: return \\\"NDA Pending\\\";\\n  }\\n}\\n\\nfunction daysSince(date: Date | string): number {\\n  const d = typeof date === \\\"string\\\" ? new Date(date) : date;\\n  return Math.floor((Date.now() - d.getTime()) / (1000 * 60 * 60 * 24));\\n}\\n\\nfunction formatRelativeTime(date: Date | string): string {\\n  const d = typeof date === \\\"string\\\" ? new Date(date) : date;\\n  const diffMs = Date.now() - d.getTime();\\n  const diffMin = Math.floor(diffMs / 60000);\\n  if (diffMin \u003c 60) return `${diffMin}m ago`;\\n  const diffHr = Math.floor(diffMin / 60);\\n  if (diffHr \u003c 24) return `${diffHr}h ago`;\\n  const diffDay = Math.floor(diffHr / 24);\\n  if (diffDay \u003c 30) return `${diffDay}d ago`;\\n  return d.toLocaleDateString();\\n}\\n\\nexport default function DealRooms() {\\n  const [, setLocation] = useLocation();\\n  const [filter, setFilter] = useState\u003cStatusFilter\u003e(\\\"all\\\");\\n  const { data: dealRooms, isLoading } = trpc.dealRoom.list.useQuery();\\n\\n  const stats = useMemo(() =\u003e {\\n    if (!dealRooms) return { active: 0, pendingNda: 0, completed: 0, total: 0 };\\n    return {\\n      active: dealRooms.filter(r =\u003e r.status === \\\"active\\\").length,\\n      pendingNda: dealRooms.filter(r =\u003e !r.status || r.status === null).length,\\n      completed: dealRooms.filter(r =\u003e r.status === \\\"closed\\\").length,\\n      total: dealRooms.length,\\n    };\\n  }, [dealRooms]);\\n\\n  const filtered = useMemo(() =\u003e {\\n    if (!dealRooms) return [];\\n    if (filter === \\\"all\\\") return dealRooms;\\n    const mapping: Record\u003cStatusFilter, (r: any) =\u003e boolean\u003e = {\\n      all: () =\u003e true,\\n      nda_pending: r =\u003e !r.status || r.status === null,\\n      active: r =\u003e r.status === \\\"active\\\",\\n      completed: r =\u003e r.status === \\\"closed\\\",\\n      declined: r =\u003e r.status === \\\"archived\\\",\\n    };\\n    return dealRooms.filter(mapping[filter]);\\n  }, [dealRooms, filter]);\\n\\n  useEffect(() =\u003e { document.title = \\\"Deal Rooms | ANAVI\\\"; }, []);\\n\\n  return (\\n    \u003cdiv className=\\\"p-8 space-y-6 animate-fade-in\\\"\u003e\\n      {/* Header */}\\n      \u003cFadeInView\u003e\\n        \u003ch1 className=\\\"dash-heading text-3xl\\\"\u003eDeal Rooms\u003c/h1\u003e\\n        {/* Subtitle added */}\\n        \u003cp className=\\\"text-lg text-[#1E3A5F]/80 mt-2\\\"\u003eNDA-gated workspaces. Immutable audit trail active on every room.\u003c/p\u003e\\n      \u003c/FadeInView\u003e\\n\\n      {/* Stats Row */}\\n      \u003cdiv className=\\\"grid grid-cols-2 md:grid-cols-4 gap-4\\\"\u003e\\n        {[\\n          { label: \\\"Active Rooms\\\", value: stats.active, color: \\\"#2563EB\\\" },\\n          { label: \\\"Pending NDA\\\", value: stats.pendingNda, color: \\\"#C4972A\\\" },\\n          { label: \\\"Completed\\\", value: stats.completed, color: \\\"#059669\\\" },\\n          { label: \\\"Total Rooms\\\", value: stats.total, color: \\\"#0A1628\\\" },\\n        ].map((s) =\u003e (\\n          \u003cdiv\\n            key={s.label}\\n            className=\\\"card-elevated p-5\\\"\\n          \u003e\\n            \u003cdiv className=\\\"text-label text-muted-foreground mb-1\\\"\u003e{s.label}\u003c/div\u003e\\n            \u003cdiv className=\\\"text-2xl font-bold number-display\\\" style={{ color: s.color }}\u003e\\n              {s.value}\\n            \u003c/div\u003e\\n          \u003c/div\u003e\\n        ))}\\n      \u003c/div\u003e\\n\\n      {/* Filter Bar */}\\n      \u003cdiv className=\\\"card-elevated p-1.5 flex flex-wrap gap-1\\\"\u003e\\n        {STATUS_FILTERS.map((sf) =\u003e {\\n          const isActive = filter === sf.key;\\n          return (\\n            \u003cbutton\\n              key={sf.key}\\n              onClick={() =\u003e setFilter(sf.key)}\\n              className={\\n                isActive\\n                  ? \\\"rounded-md px-3 py-1.5 text-xs font-semibold bg-[#0A1628] text-white cursor-pointer transition-all\\\"\\n                  : \\\"rounded-md px-3 py-1.5 text-xs font-medium text-[#1E3A5F]/60 hover:text-[#0A1628] hover:bg-[#0A1628]/5 cursor-pointer transition-all\\\"\\n              }\\n            \u003e\\n              {sf.label}\\n            \u003c/button\u003e\\n          );\\n        })}\\n      \u003c/div\u003e\\n\\n      {/* Deal Room Cards */}\\n      {isLoading ? (\\n        \u003cdiv className=\\\"grid md:grid-cols-2 lg:grid-cols-3 gap-4\\\"\u003e\\n          {[1, 2, 3].map((i) =\u003e (\\n            \u003cdiv key={i} className=\\\"card-elevated p-6\\\"\u003e\\n              \u003cdiv className=\\\"h-40 animate-shimmer rounded-lg\\\" /\u003e\\n            \u003c/div\u003e\\n          ))}\\n        \u003c/div\u003e\\n      ) : filtered.length === 0 ? (\\n        \u003cdiv className=\\\"card-elevated p-6\\\"\u003e\\n          \u003cEmptyState {...EMPTY_STATES.dealRooms} /\u003e\\n        \u003c/div\u003e\\n      ) : (\\n        \u003cStaggerContainer className=\\\"grid md:grid-cols-2 lg:grid-cols-3 gap-4\\\"\u003e\\n          {filtered.map((room) =\u003e {\\n            const settings = (room.settings as any) || {};\\n            const days = daysSince(room.createdAt);\\n            const lastActivity = formatRelativeTime(room.updatedAt || room.createdAt);\\n\\n            return (\\n              \u003cStaggerItem key={room.id}\u003e\\n              \u003cScaleHover\u003e\\n              \u003cdiv className=\\\"card-elevated flex flex-col hover:translate-y-[-2px]\\\"\u003e\\n                \u003cdiv className=\\\"p-5 flex-1 space-y-3\\\"\u003e\\n                  {/* Status pill */}\\n                  \u003cdiv className=\\\"flex justify-end\\\"\u003e\\n                    \u003cspan className={`inline-flex ${getStatusClass(room.status)}`}\u003e\\n                      {getStatusLabel(room.status)}\\n                    \u003c/span\u003e\\n                  \u003c/div\u003e\\n\\n                  {/* Room name */}\\n                  \u003ch3 className=\\\"font-semibold text-base\\\" style={{ color: \\\"#0A1628\\\" }}\u003e\\n                    {room.name}\\n                  \u003c/h3\u003e\\n\\n                  {/* New text line added */}\\n                  \u003cp className=\\\"text-[10px] text-[#1E3A5F]/50\\\"\u003eEvery document access and signature is cryptographically logged.\u003c/p\u003e\\n\\n                  {/* Parties (anonymized) */}\\n                  \u003cdiv className=\\\"text-sm text-muted-foreground\\\"\u003e\\n                    \u003cspan className=\\\"font-medium\\\"\u003eParty A\u003c/span\u003e\\n                    {\\\" â†” \\\"}\\n                    \u003cspan className=\\\"font-medium\\\"\u003eParty B\u003c/span\u003e\\n                  \u003c/div\u003e\\n\\n                  {/* Meta row */}\\n                  \u003cdiv className=\\\"flex flex-wrap items-center gap-x-4 gap-y-1 text-xs text-muted-foreground\\\"\u003e\\n                    \u003cspan className=\\\"flex items-center gap-1\\\"\u003e\\n                      \u003cClock className=\\\"w-3.5 h-3.5\\\" /\u003e\\n                      {days}d in room\\n                    \u003c/span\u003e\\n                    \u003cspan\u003eLast: \u003cspan className=\\\"font-data-hud text-[10px] text-[#1E3A5F]/50\\\"\u003e{lastActivity}\u003c/span\u003e\u003c/span\u003e\\n                  \u003c/div\u003e\\n\\n                  {/* Badges */}\\n                  \u003cdiv className=\\\"flex flex-wrap gap-1.5 pt-1\\\"\u003e\\n                    {room.ndaRequired && (\\n                      \u003cspan className=\\\"inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-[11px] font-medium bg-orange-50 text-orange-700\\\"\u003e\\n                        \u003cLock className=\\\"w-3 h-3\\\" /\u003e\\n                        NDA Required\\n                      \u003c/span\u003e\\n                    )}\\n                    {settings.watermarkDocuments && (\\n                      \u003cspan className=\\\"inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-[11px] font-medium bg-blue-50 text-blue-700\\\"\u003e\\n                        \u003cEye className=\\\"w-3 h-3\\\" /\u003e\\n                        Watermarking\\n                      \u003c/span\u003e\\n                    )}\\n                    {settings.allowDownloads === false && (\\n                      \u003cspan className=\\\"inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-[11px] font-medium bg-red-50 text-red-700\\\"\u003e\\n                        \u003cDownload className=\\\"w-3 h-3\\\" /\u003e\\n                        Download Controls\\n                      \u003c/span\u003e\\n                    )}\\n                  \u003c/div\u003e\\n                \u003c/div\u003e\\n\\n                {/* CTA */}\\n                \u003cdiv className=\\\"px-5 pb-5 pt-2\\\"\u003e\\n                  \u003cbutton\\n                    onClick={() =\u003e setLocation(`/deal-rooms/${room.id}`)}\\n                    className=\\\"w-full flex items-center justify-center gap-2 rounded-lg px-4 py-2.5 text-sm font-medium text-white transition-colors\\\"\\n                    style={{ background: \\\"#2563EB\\\" }}\\n                  \u003e\\n                    Enter Room\\n                    \u003cChevronRight className=\\\"w-4 h-4\\\" /\u003e\\n                  \u003c/button\u003e\\n                \u003c/div\u003e\\n              \u003c/div\u003e\\n              \u003c/ScaleHover\u003e\\n              \u003c/StaggerItem\u003e\\n            );\\n          })}\\n        \u003c/StaggerContainer\u003e\\n      )}\\n    \u003c/div\u003e\\n  );\\n}\\n\",\n  \"changes_summary\": [\n    \"Removed 'Diligence' and 'Closing' status filters from the `STATUS_FILTERS` array and the `StatusFilter` type, aligning with the schema's available statuses.\",\n    \"Updated the `filtered` `useMemo` mapping to correctly filter deal rooms based on the remaining 'all', 'nda_pending', 'active', 'completed', and 'declined' statuses.\",\n    \"Changed the 'Total Value' stat card label to 'Total Rooms' and its displayed value from a calculated monetary amount to the raw count of `stats.total`.\",\n    \"Added a subtitle 'NDA-gated workspaces. Immutable audit trail active on every room.' directly below the main 'Deal Rooms' heading.\",\n    \"Inserted a small text line 'Every document access and signature is cryptographically logged.' below each deal room's name within the deal room cards, styled with `text-[10px] text-[#1E3A5F]/50`.\"\n  ],\n  \"whitepaper_terms_added\": [\n    \"NDA-gated workspaces\",\n    \"Immutable audit trail\",\n    \"cryptographically logged\"\n  ],\n  \"copy_tokens_used\": [\n    \"EMPTY_STATES.dealRooms\"\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 6963,
    "candidatesTokenCount": 3233,
    "totalTokenCount": 14571,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 6963
      }
    ],
    "thoughtsTokenCount": 4375
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "H-ihaYypLfiHz7IPnNuIiAU"
}
