{
  "candidates": [
    {
      "content": {
        "parts": [
          {
            "text": "```json\n{\n  \"upgraded_tsx\": \"import { useState, useMemo, useEffect } from \\\"react\\\";\\nimport { trpc } from \\\"@/lib/trpc\\\";\\nimport { Badge } from \\\"@/components/ui/badge\\\";\\nimport { Button } from \\\"@/components/ui/button\\\";\\nimport { Input } from \\\"@/components/ui/input\\\";\\nimport { EmptyState, EMPTY_STATES } from \\\"@/components/EmptyState\\\";\\nimport { FadeInView } from \\\"@/components/PageTransition\\\";\\nimport { SmoothCounter } from \\\"@/components/PremiumAnimations\\\";\\nimport {\\n  Select,\\n  SelectContent,\\n  SelectItem,\\n  SelectTrigger,\\n  SelectValue,\\n} from \\\"@/components/ui/select\\\";\\nimport {\\n  Wallet,\\n  AlertCircle,\\n  ChevronDown,\\n  ChevronRight,\\n  Link2,\\n  Download,\\n  FileText,\\n} from \\\"lucide-react\\\";\\nimport { format, formatDistanceToNow } from \\\"date-fns\\\";\\nimport { toast } from \\\"sonner\\\";\\nimport { DASHBOARD } from \\\"@/lib/copy\\\";\\n\\n\\nconst fmtCurrency = (amount: number) =\u003e\\n  new Intl.NumberFormat(\\\"en-US\\\", { style: \\\"currency\\\", currency: \\\"USD\\\" }).format(\\n    amount,\\n  );\\n\\ntype PayoutStatus = \\\"all\\\" | \\\"pending\\\" | \\\"processing\\\" | \\\"completed\\\" | \\\"failed\\\";\\ntype PayoutTypeFilter =\\n  | \\\"all\\\"\\n  | \\\"originator_fee\\\"\\n  | \\\"introducer_fee\\\"\\n  | \\\"advisor_fee\\\"\\n  | \\\"milestone_bonus\\\"\\n  | \\\"success_fee\\\";\\n\\nconst STATUS_OPTIONS: { value: PayoutStatus; label: string }[] = [\\n  { value: \\\"all\\\", label: \\\"All\\\" },\\n  { value: \\\"pending\\\", label: \\\"Pending\\\" },\\n  { value: \\\"processing\\\", label: \\\"Processing\\\" },\\n  { value: \\\"completed\\\", label: \\\"Completed\\\" },\\n  { value: \\\"failed\\\", label: \\\"Failed\\\" },\\n];\\n\\nconst TYPE_OPTIONS: { value: PayoutTypeFilter; label: string }[] = [\\n  { value: \\\"all\\\", label: \\\"All\\\" },\\n  { value: \\\"originator_fee\\\", label: \\\"Originator Fee\\\" },\\n  { value: \\\"introducer_fee\\\", label: \\\"Introducer Fee\\\" },\\n  { value: \\\"advisor_fee\\\", label: \\\"Advisor Fee\\\" },\\n  { value: \\\"milestone_bonus\\\", label: \\\"Milestone Bonus\\\" },\\n  { value: \\\"success_fee\\\", label: \\\"Success Fee\\\" },\\n];\\n\\nfunction getTypeLabel(type: string) {\\n  return (\\n    TYPE_OPTIONS.find((t) =\u003e t.value === type)?.label ??\\n    type.replace(/_/g, \\\" \\\")\\n  );\\n}\\n\\nfunction getTypeBadgeClasses(type: string): string {\\n  switch (type) {\\n    case \\\"originator_fee\\\":\\n      return \\\"bg-slate-900 text-white\\\";\\n    case \\\"introducer_fee\\\":\\n      return \\\"bg-blue-600 text-white\\\";\\n    case \\\"advisor_fee\\\":\\n      return \\\"bg-[#C4972A] text-white\\\";\\n    case \\\"milestone_bonus\\\":\\n      return \\\"bg-emerald-600 text-white\\\";\\n    case \\\"success_fee\\\":\\n      return \\\"bg-violet-600 text-white\\\";\\n    default:\\n      return \\\"\\\";\\n  }\\n}\\n\\nfunction PayoutStatementSection() {\\n  const [periodStart, setPeriodStart] = useState(() =\u003e\\n    format(new Date(new Date().getFullYear(), new Date().getMonth(), 1), \\\"yyyy-MM-dd\\\")\\n  );\\n  const [periodEnd, setPeriodEnd] = useState(() =\u003e format(new Date(), \\\"yyyy-MM-dd\\\"));\\n  const [showModal, setShowModal] = useState(false);\\n\\n  const { data: statement, isLoading } = trpc.payout.getStatement.useQuery(\\n    {\\n      periodStart: `${periodStart}T00:00:00.000Z`,\\n      periodEnd: `${periodEnd}T23:59:59.999Z`,\\n    },\\n    { enabled: showModal && !!periodStart && !!periodEnd }\\n  );\\n\\n  const downloadCSV = () =\u003e {\\n    if (!statement) return;\\n    const header = \\\"Deal ID,Amount,Currency,Type,Status,Date\\\\n\\\";\\n    const rows = statement.items.map(\\n      (p: any) =\u003e\\n        `${p.dealId ?? \\\"\\\"},${p.amount ?? 0},${p.currency ?? \\\"USD\\\"},${p.payoutType ?? \\\"\\\"},${p.status ?? \\\"\\\"},\\\"${new Date(p.createdAt).toLocaleDateString()}\\\"`\\n    ).join(\\\"\\\\n\\\");\\n    const blob = new Blob([header + rows], { type: \\\"text/csv\\\" });\\n    const url = URL.createObjectURL(blob);\\n    const a = document.createElement(\\\"a\\\");\\n    a.href = url;\\n    a.download = `ANAVI-Payout-Statement-${periodStart}-${periodEnd}.csv`;\\n    a.click();\\n    URL.revokeObjectURL(url);\\n    toast.success(\\\"Statement downloaded\\\");\\n  };\\n\\n  return (\\n    \u003cdiv className=\\\"card-elevated p-6\\\"\u003e\\n      \u003ch3 className=\\\"data-label mb-2 text-slate-900\\\"\u003e\\n        Payout Statement\\n      \u003c/h3\u003e\\n      \u003cp className=\\\"text-sm text-muted-foreground mb-4\\\"\u003e\\n        Official ANAVI payout statement. Select a period and view or download.\\n      \u003c/p\u003e\\n      \u003cdiv className=\\\"flex flex-wrap gap-3 items-end\\\"\u003e\\n        \u003cdiv className=\\\"space-y-1\\\"\u003e\\n          \u003clabel className=\\\"text-xs font-semibold uppercase text-muted-foreground\\\"\u003eStart\u003c/label\u003e\\n          \u003cInput\\n            type=\\\"date\\\"\\n            value={periodStart}\\n            onChange={(e) =\u003e setPeriodStart(e.target.value)}\\n            className=\\\"w-[160px]\\\"\\n          /\u003e\\n        \u003c/div\u003e\\n        \u003cdiv className=\\\"space-y-1\\\"\u003e\\n          \u003clabel className=\\\"text-xs font-semibold uppercase text-muted-foreground\\\"\u003eEnd\u003c/label\u003e\\n          \u003cInput\\n            type=\\\"date\\\"\\n            value={periodEnd}\\n            onChange={(e) =\u003e setPeriodEnd(e.target.value)}\\n            className=\\\"w-[160px]\\\"\\n          /\u003e\\n        \u003c/div\u003e\\n        \u003cButton\\n          className=\\\"btn-gold gap-2\\\"\\n          onClick={() =\u003e setShowModal(true)}\\n        \u003e\\n          \u003cFileText className=\\\"w-4 h-4\\\" /\u003e\\n          View Statement\\n        \u003c/Button\u003e\\n      \u003c/div\u003e\\n      {showModal && (\\n        \u003cdiv className=\\\"fixed inset-0 z-50 flex items-center justify-center\\\"\u003e\\n          \u003cdiv className=\\\"absolute inset-0 bg-black/50\\\" onClick={() =\u003e setShowModal(false)} /\u003e\\n          \u003cdiv className=\\\"relative z-10 bg-white rounded-xl shadow-xl max-w-lg w-full mx-4 max-h-[80vh] overflow-hidden\\\"\u003e\\n            \u003cdiv className=\\\"p-6 border-b border-slate-200\\\"\u003e\\n              \u003ch4 className=\\\"text-lg font-semibold text-slate-900\\\"\u003e\\n                Official ANAVI Payout Statement\\n              \u003c/h4\u003e\\n              \u003cp className=\\\"text-sm text-muted-foreground mt-1\\\"\u003e\\n                {periodStart} — {periodEnd} · Generated {format(new Date(), \\\"PP\\\")}\\n              \u003c/p\u003e\\n            \u003c/div\u003e\\n            \u003cdiv className=\\\"p-6 overflow-y-auto max-h-[50vh]\\\"\u003e\\n              {isLoading ? (\\n                \u003cp className=\\\"text-sm text-muted-foreground\\\"\u003eLoading…\u003c/p\u003e\\n              ) : !statement || statement.items.length === 0 ? (\\n                \u003cp className=\\\"text-sm text-muted-foreground\\\"\u003e\\n                  No payouts in this period. Select a different range.\\n                \u003c/p\u003e\\n              ) : (\\n                \u003cdiv className=\\\"space-y-3\\\"\u003e\\n                  {statement.items.map((p: any, i: number) =\u003e (\\n                    \u003cdiv key={i} className=\\\"flex justify-between py-2 border-b border-slate-200\\\"\u003e\\n                      \u003cspan className=\\\"text-sm\\\"\u003eDeal #{p.dealId}\u003c/span\u003e\\n                      \u003cspan className=\\\"font-data-hud font-semibold\\\"\u003e\\n                        {fmtCurrency(Number(p.amount ?? 0))}\\n                      \u003c/span\u003e\\n                    \u003c/div\u003e\\n                  ))}\\n                  \u003cdiv className=\\\"flex justify-between pt-3 font-bold text-base text-slate-900\\\"\u003e\\n                    \u003cspan\u003eTotal\u003c/span\u003e\\n                    \u003cspan\u003e{fmtCurrency(statement.total ?? 0)}\u003c/span\u003e\\n                  \u003c/div\u003e\\n                \u003c/div\u003e\\n              )}\\n            \u003c/div\u003e\\n            \u003cdiv className=\\\"p-6 border-t border-slate-200 flex justify-between\\\"\u003e\\n              \u003cButton variant=\\\"outline\\\" onClick={() =\u003e setShowModal(false)}\u003e\\n                Close\\n              \u003c/Button\u003e\\n              \u003cButton className=\\\"btn-gold gap-2\\\" onClick={downloadCSV} disabled={!statement || statement.items.length === 0}\u003e\\n                \u003cDownload className=\\\"w-4 h-4\\\" /\u003e\\n                Download CSV\\n              \u003c/Button\u003e\\n            \u003c/div\u003e\\n          \u003c/div\u003e\\n        \u003c/div\u003e\\n      )}\\n    \u003c/div\u003e\\n  );\\n}\\n\\nfunction getStatusPillClasses(status: string) {\\n  switch (status) {\\n    case \\\"pending\\\":\\n      return \\\"bg-orange-100 text-orange-700\\\";\\n    case \\\"processing\\\":\\n      return \\\"bg-blue-100 text-blue-700\\\";\\n    case \\\"completed\\\":\\n      return \\\"bg-emerald-100 text-emerald-700\\\";\\n    case \\\"failed\\\":\\n      return \\\"bg-red-100 text-red-700\\\";\\n    default:\\n      return \\\"bg-gray-100 text-gray-600\\\";\\n  }\\n}\\n\\nfunction buildMonthOptions() {\\n  const now = new Date();\\n  const opts: { value: string; label: string }[] = [\\n    { value: \\\"all\\\", label: \\\"All Time\\\" },\\n  ];\\n  for (let i = 0; i \u003c 12; i++) {\\n    const d = new Date(now.getFullYear(), now.getMonth() - i, 1);\\n    opts.push({\\n      value: `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, \\\"0\\\")}`,\\n      label: format(d, \\\"MMMM yyyy\\\"),\\n    });\\n  }\\n  return opts;\\n}\\n\\nexport default function Payouts() {\\n  const { data: payouts, isLoading } = trpc.payout.list.useQuery();\\n  useEffect(() =\u003e { document.title = \\\"Payouts | ANAVI\\\"; }, []);\\n\\n  const [statusFilter, setStatusFilter] = useState\u003cPayoutStatus\u003e(\\\"all\\\");\\n  const [typeFilter, setTypeFilter] = useState\u003cPayoutTypeFilter\u003e(\\\"all\\\");\\n  const [monthFilter, setMonthFilter] = useState(\\\"all\\\");\\n  const [expandedDeal, setExpandedDeal] = useState\u003cnumber | null\u003e(null);\\n\\n  const monthOptions = useMemo(buildMonthOptions, []);\\n\\n  const completedPayouts = useMemo(\\n    () =\u003e payouts?.filter((p) =\u003e p.status === \\\"completed\\\") ?? [],\\n    [payouts],\\n  );\\n\\n  const totalEarnings = useMemo(\\n    () =\u003e completedPayouts.reduce((s, p) =\u003e s + parseFloat(p.amount), 0),\\n    [completedPayouts],\\n  );\\n\\n  const pendingAmount = useMemo(\\n    () =\u003e\\n      (payouts ?? [])\\n        .filter((p) =\u003e p.status === \\\"pending\\\" || p.status === \\\"processing\\\")\\n        .reduce((s, p) =\u003e s + parseFloat(p.amount), 0),\\n    [payouts],\\n  );\\n\\n  const thisMonthEarnings = useMemo(() =\u003e {\\n    const now = new Date();\\n    return (payouts ?? [])\\n      .filter((p) =\u003e {\\n        if (p.status !== \\\"completed\\\") return false;\\n        const d = new Date(p.paidAt ?? p.createdAt);\\n        return (\\n          d.getMonth() === now.getMonth() &&\\n          d.getFullYear() === now.getFullYear()\\n        );\\n      })\\n      .reduce((s, p) =\u003e s + parseFloat(p.amount), 0);\\n  }, [payouts]);\\n\\n  const completedDealCount = useMemo(\\n    () =\u003e new Set(completedPayouts.map((p) =\u003e p.dealId)).size,\\n    [completedPayouts],\\n  );\\n\\n  const filteredPayouts = useMemo(() =\u003e {\\n    if (!payouts) return [];\\n    return payouts.filter((p) =\u003e {\\n      if (statusFilter !== \\\"all\\\" && p.status !== statusFilter) return false;\\n      if (typeFilter !== \\\"all\\\" && p.payoutType !== typeFilter) return false;\\n      if (monthFilter !== \\\"all\\\") {\\n        const d = new Date(p.createdAt);\\n        const key = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, \\\"0\\\")}`;\\n        if (key !== monthFilter) return false;\\n      }\\n      return true;\\n    });\\n  }, [payouts, statusFilter, typeFilter, monthFilter]);\\n\\n  const dealGroups = useMemo(() =\u003e {\\n    if (!payouts) return [];\\n    const map = new Map\u003c\\n      number,\\n      { dealId: number; payouts: typeof payouts; total: number }\\n    \u003e();\\n    for (const p of payouts) {\\n      if (!map.has(p.dealId))\\n        map.set(p.dealId, { dealId: p.dealId, payouts: [], total: 0 });\\n      const g = map.get(p.dealId)!;\\n      g.payouts.push(p);\\n      g.total += parseFloat(p.amount);\\n    }\\n    return Array.from(map.values()).sort((a, b) =\u003e b.total - a.total);\\n  }, [payouts]);\\n\\n  if (isLoading) {\\n    return (\\n      \u003cdiv className=\\\"p-8 space-y-6\\\"\u003e\\n        \u003cdiv className=\\\"h-8 w-56 rounded-lg animate-pulse bg-slate-50\\\" /\u003e\\n        \u003cdiv className=\\\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\\\"\u003e\\n          {[1, 2, 3, 4].map((i) =\u003e (\\n            \u003cdiv key={i} className=\\\"h-32 rounded-xl animate-pulse bg-slate-50\\\" /\u003e\\n          ))}\\n        \u003c/div\u003e\\n        \u003cdiv className=\\\"h-48 rounded-xl animate-pulse bg-slate-50\\\" /\u003e\\n        \u003cdiv className=\\\"h-64 rounded-xl animate-pulse bg-slate-50\\\" /\u003e\\n      \u003c/div\u003e\\n    );\\n  }\\n\\n  const empty = !payouts || payouts.length === 0;\\n\\n  return (\\n    \u003cdiv className=\\\"p-8 space-y-8\\\"\u003e\\n      {/* ── Page Header ────────────────────────────────────────────── */}\\n      \u003cFadeInView\u003e\\n      \u003cdiv\u003e\\n        \u003ch1 className=\\\"text-display tracking-tight flex items-center gap-3 text-slate-900\\\"\u003e\\n          \u003cdiv className=\\\"w-10 h-10 rounded-xl flex items-center justify-center bg-slate-50\\\"\u003e\\n            \u003cWallet className=\\\"w-5 h-5 text-blue-600\\\" /\u003e\\n          \u003c/div\u003e\\n          Payouts &amp; Earnings\\n        \u003c/h1\u003e\\n        \u003cp className=\\\"text-muted-foreground mt-2\\\"\u003e\\n          Track your earnings from deal origination and introductions\\n        \u003c/p\u003e\\n      \u003c/div\u003e\\n      \u003c/FadeInView\u003e\\n\\n      {/* ── Attribution Summary Hero ────────────────────────────────── */}\\n      \u003cdiv className=\\\"card-elevated p-6 mb-6\\\"\u003e\\n        \u003cdiv className=\\\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\\\"\u003e\\n          {/* Total Earnings (Lifetime Attribution) */}\\n          \u003cdiv\u003e\\n            \u003cp className=\\\"data-label mb-1\\\"\u003e{DASHBOARD.payouts.lifetimeAttribution}\u003c/p\u003e\\n            \u003cp className=\\\"font-data-hud text-3xl font-bold text-emerald-600\\\"\u003e\\n              $\u003cSmoothCounter value={totalEarnings} duration={1.2} /\u003e\\n            \u003c/p\u003e\\n          \u003c/div\u003e\\n          {/* Next Payout (Pending Amount) */}\\n          \u003cdiv\u003e\\n            \u003cp className=\\\"data-label mb-1\\\"\u003eNext Payout\u003c/p\u003e\\n            \u003cp className=\\\"font-data-hud text-3xl font-bold text-slate-900\\\"\u003e\\n              $\u003cSmoothCounter value={pendingAmount} duration={1} /\u003e\\n            \u003c/p\u003e\\n          \u003c/div\u003e\\n          {/* Pending Count */}\\n          \u003cdiv\u003e\\n            \u003cp className=\\\"data-label mb-1\\\"\u003ePending\u003c/p\u003e\\n            \u003cp className=\\\"font-data-hud text-3xl font-bold text-[#C4972A]\\\"\u003e\\n              \u003cSmoothCounter value={(payouts ?? []).filter((p) =\u003e p.status === \\\"pending\\\" || p.status === \\\"processing\\\").length} duration={1} /\u003e\\n            \u003c/p\u003e\\n          \u003c/div\u003e\\n          {/* This Month */}\\n          \u003cdiv\u003e\\n            \u003cp className=\\\"data-label mb-1\\\"\u003eThis Month\u003c/p\u003e\\n            \u003cp className=\\\"font-data-hud text-3xl font-bold text-blue-600\\\"\u003e\\n              $\u003cSmoothCounter value={thisMonthEarnings} duration={1} /\u003e\\n            \u003c/p\u003e\\n          \u003c/div\u003e\\n        \u003c/div\u003e\\n      \u003c/div\u003e\\n\\n      {/* F7: Payout Statement */}\\n      \u003cPayoutStatementSection /\u003e\\n\\n      {/* ── Economics Overview ──────────────────────────────────────── */}\\n      \u003cdiv className=\\\"card-elevated p-6 space-y-5\\\"\u003e\\n          \u003ch3 className=\\\"text-lg font-semibold text-slate-900\\\"\u003e\\n            ANAVI Economics Model\\n          \u003c/h3\u003e\\n          \u003cdiv className=\\\"flex gap-1 h-8 rounded-lg overflow-hidden\\\"\u003e\\n            \u003cdiv\\n              className=\\\"flex items-center justify-center text-xs font-semibold text-white bg-slate-900\\\"\\n              style={{ flex: \\\"50 0 0%\\\" }}\\n            \u003e\\n              Originator 40–60%\\n            \u003c/div\u003e\\n            \u003cdiv\\n              className=\\\"flex items-center justify-center text-xs font-semibold text-white bg-blue-600\\\"\\n              style={{ flex: \\\"25 0 0%\\\" }}\\n            \u003e\\n              Contributors 20–30%\\n            \u003c/div\u003e\\n            \u003cdiv\\n              className=\\\"flex items-center justify-center text-xs font-semibold text-white bg-[#C4972A]\\\"\\n              style={{ flex: \\\"15 0 0%\\\" }}\\n            \u003e\\n              Platform 10–20%\\n            \u003c/div\u003e\\n          \u003c/div\u003e\\n          \u003cp className=\\\"text-sm text-muted-foreground leading-relaxed\\\"\u003e\\n            When deals close through ANAVI, payouts are automated. Originators receive the largest share — guaranteed at close.\\n          \u003c/p\u003e\\n      \u003c/div\u003e\\n\\n      {/* ── Attribution History ─────────────────────────────────────── */}\\n      \u003cdiv className=\\\"card-elevated p-6 space-y-6\\\"\u003e\\n        \u003ch3 className=\\\"data-label text-slate-900\\\"\u003e\\n          Attribution History\\n        \u003c/h3\u003e\\n          {/* Filter Bar */}\\n          \u003cdiv className=\\\"flex flex-wrap gap-3\\\"\u003e\\n            \u003cSelect\\n              value={statusFilter}\\n              onValueChange={(v) =\u003e setStatusFilter(v as PayoutStatus)}\\n            \u003e\\n              \u003cSelectTrigger className=\\\"w-[150px]\\\"\u003e\\n                \u003cSelectValue placeholder=\\\"Status\\\" /\u003e\\n              \u003c/SelectTrigger\u003e\\n              \u003cSelectContent\u003e\\n                {STATUS_OPTIONS.map((o) =\u003e (\\n                  \u003cSelectItem key={o.value} value={o.value}\u003e\\n                    {o.label}\\n                  \u003c/SelectItem\u003e\\n                ))}\\n              \u003c/SelectContent\u003e\\n            \u003c/Select\u003e\\n\\n            \u003cSelect\\n              value={typeFilter}\\n              onValueChange={(v) =\u003e setTypeFilter(v as PayoutTypeFilter)}\\n            \u003e\\n              \u003cSelectTrigger className=\\\"w-[180px]\\\"\u003e\\n                \u003cSelectValue placeholder=\\\"Type\\\" /\u003e\\n              \u003c/SelectTrigger\u003e\\n              \u003cSelectContent\u003e\\n                {TYPE_OPTIONS.map((o) =\u003e (\\n                  \u003cSelectItem key={o.value} value={o.value}\u003e\\n                    {o.label}\\n                  \u003c/SelectItem\u003e\\n                ))}\\n              \u003c/SelectContent\u003e\\n            \u003c/Select\u003e\\n\\n            \u003cSelect value={monthFilter} onValueChange={setMonthFilter}\u003e\\n              \u003cSelectTrigger className=\\\"w-[180px]\\\"\u003e\\n                \u003cSelectValue placeholder=\\\"Date Range\\\" /\u003e\\n              \u003c/SelectTrigger\u003e\\n              \u003cSelectContent\u003e\\n                {monthOptions.map((o) =\u003e (\\n                  \u003cSelectItem key={o.value} value={o.value}\u003e\\n                    {o.label}\\n                  \u003c/SelectItem\u003e\\n                ))}\\n              \u003c/SelectContent\u003e\\n            \u003c/Select\u003e\\n          \u003c/div\u003e\\n\\n          {/* Payout Table */}\\n          {empty ? (\\n            \u003cdiv className=\\\"py-12\\\"\u003e\\n              \u003cEmptyState {...EMPTY_STATES.payouts} /\u003e\\n            \u003c/div\u003e\\n          ) : filteredPayouts.length === 0 ? (\\n            \u003cdiv className=\\\"text-center py-12\\\"\u003e\\n              \u003cAlertCircle className=\\\"w-10 h-10 mx-auto mb-3 text-muted-foreground\\\" /\u003e\\n              \u003cp className=\\\"text-muted-foreground\\\"\u003eNo payouts match the selected filters.\u003c/p\u003e\\n            \u003c/div\u003e\\n          ) : (\\n            \u003cdiv className=\\\"flex flex-col gap-3\\\"\u003e\\n              {filteredPayouts.map((p) =\u003e (\\n                \u003cdiv\\n                  key={p.id}\\n                  className=\\\"card-elevated px-4 py-3 flex items-center justify-between hover:translate-y-[-1px] transition-transform\\\"\\n                \u003e\\n                  \u003cdiv\u003e\\n                    \u003cp className=\\\"font-data-hud text-base font-semibold text-slate-900\\\"\u003e\\n                      {fmtCurrency(parseFloat(p.amount))}\\n                    \u003c/p\u003e\\n                    \u003cp className=\\\"data-label mt-0.5\\\"\u003e{getTypeLabel(p.payoutType)}\u003c/p\u003e\\n                  \u003c/div\u003e\\n                  \u003cdiv className=\\\"flex items-center gap-3 flex-wrap\\\"\u003e\\n                    \u003cspan className=\\\"font-medium text-sm text-blue-600\\\"\u003e\\n                      Deal&nbsp;#{p.dealId}\\n                    \u003c/span\u003e\\n                    \u003cspan className=\\\"data-label\\\"\u003e{format(new Date(p.createdAt), \\\"MMM d\\\")}\u003c/span\u003e\\n                    \u003cBadge className={`${getStatusPillClasses(p.status ?? \\\"pending\\\")} border-0 text-[11px]`}\u003e\\n                      {p.status ?? \\\"pending\\\"}\\n                    \u003c/Badge\u003e\\n                    {p.relationshipId && (\\n                      \u003cspan className=\\\"inline-flex items-center gap-1 text-xs text-blue-600\\\"\u003e\\n                        \u003cLink2 className=\\\"w-3 h-3\\\" /\u003e\\n                        REL-{p.relationshipId}\\n                      \u003c/span\u003e\\n                    )}\\n                    {p.isFollowOn && (\\n                      \u003cspan className=\\\"text-[10px] font-semibold px-1.5 py-0.5 rounded bg-blue-50 text-blue-600\\\"\u003e\\n                        Follow-on\\n                      \u003c/span\u003e\\n                    )}\\n                  \u003c/div\u003e\\n                \u003c/div\u003e\\n              ))}\\n            \u003c/div\u003e\\n          )}\\n      \u003c/div\u003e\\n\\n      {/* ── Deal Payout Timeline ───────────────────────────────────── */}\\n      {!empty && dealGroups.length \u003e 0 && (\\n        \u003cdiv className=\\\"card-elevated p-6 space-y-6\\\"\u003e\\n          \u003ch3 className=\\\"mb-2 text-sm font-semibold uppercase tracking-wide text-[#1E3A5F]\\\"\u003e\\n            Attribution Chain\\n          \u003c/h3\u003e\\n          \u003cp className=\\\"text-sm text-muted-foreground mb-4\\\"\u003e\\n            Every credit in this chain is cryptographically linked to your origination event.\\n          \u003c/p\u003e\\n          \u003ch3 className=\\\"data-label text-slate-900\\\"\u003e\\n            Deal Payout Timeline\\n          \u003c/h3\u003e\\n            {dealGroups.map((group) =\u003e {\\n              const isExpanded = expandedDeal === group.dealId;\\n              return (\\n                \u003cdiv key={group.dealId} className=\\\"card-elevated p-4\\\"\u003e\\n                  {/* Deal header */}\\n                  \u003cbutton\\n                    type=\\\"button\\\"\\n                    className=\\\"w-full flex items-center justify-between gap-4 text-left\\\"\\n                    onClick={() =\u003e setExpandedDeal(isExpanded ? null : group.dealId)}\\n                  \u003e\\n                    \u003cdiv className=\\\"flex items-center gap-3 min-w-0\\\"\u003e\\n                      {isExpanded ? (\\n                        \u003cChevronDown className=\\\"w-5 h-5 shrink-0 text-slate-900\\\" /\u003e\\n                      ) : (\\n                        \u003cChevronRight className=\\\"w-5 h-5 shrink-0 text-slate-900\\\" /\u003e\\n                      )}\\n                      \u003cspan className=\\\"font-semibold truncate text-slate-900\\\"\u003e\\n                        Deal #{group.dealId}\\n                      \u003c/span\u003e\\n                      \u003cspan className=\\\"text-xs text-muted-foreground\\\"\u003e\\n                        {group.payouts.length} payout{group.payouts.length !== 1 && \\\"s\\\"}\\n                      \u003c/span\u003e\\n                    \u003c/div\u003e\\n                                \u003cspan className=\\\"font-data-hud font-bold shrink-0 text-emerald-600\\\"\u003e\\n                                    {fmtCurrency(group.total)}\\n                                  \u003c/span\u003e\\n                  \u003c/button\u003e\\n\\n                  {/* Milestone Timeline */}\\n                  {isExpanded && (\\n                    \u003cdiv className=\\\"mt-5 ml-6 border-l-2 border-slate-200 pl-6 space-y-5\\\"\u003e\\n                      {group.payouts\\n                        .sort(\\n                          (a, b) =\u003e\\n                            new Date(a.createdAt).getTime() -\\n                            new Date(b.createdAt).getTime(),\\n                        )\\n                        .map((p) =\u003e {\\n                          const dotColorClass =\\n                            p.status === \\\"completed\\\"\\n                              ? \\\"bg-slate-900\\\"\\n                              : p.status === \\\"pending\\\"\\n                                ? \\\"bg-[#C4972A]\\\"\\n                                : \\\"bg-gray-300\\\";\\n                          return (\\n                            \u003cdiv key={p.id} className=\\\"relative\\\"\u003e\\n                              {/* Dot */}\\n                              \u003cdiv\\n                                className={`absolute -left-[33px] top-1 w-4 h-4 rounded-full border-2 border-white ${dotColorClass}`}\\n                              /\u003e\\n                              \u003cdiv className=\\\"flex flex-wrap items-start justify-between gap-2\\\"\u003e\\n                                \u003cdiv className=\\\"space-y-1\\\"\u003e\\n                                  \u003cp className=\\\"font-medium text-sm text-slate-900\\\"\u003e\\n                                    {p.milestoneName ?? getTypeLabel(p.payoutType)}\\n                                  \u003c/p\u003e\\n                                  \u003cdiv className=\\\"flex items-center gap-2 flex-wrap\\\"\u003e\\n                                    \u003cBadge\\n                                      className={`border-0 text-[11px] ${getTypeBadgeClasses(p.payoutType)}`}\\n                                    \u003e\\n                                      {getTypeLabel(p.payoutType)}\\n                                    \u003c/Badge\u003e\\n                                    \u003cBadge\\n                                      className={`${getStatusPillClasses(p.status ?? \\\"pending\\\")} border-0 text-[11px]`}\\n                                    \u003e\\n                                      {p.status ?? \\\"pending\\\"}\\n                                    \u003c/Badge\u003e\\n                                    {p.isFollowOn && (\\n                                      \u003cspan className=\\\"text-[10px] font-semibold px-1.5 py-0.5 rounded bg-blue-50 text-blue-600\\\"\u003e\\n                                        Follow-on\\n                                      \u003c/span\u003e\\n                                    )}\\n                                  \u003c/div\u003e\\n                                  {p.attributionPercentage && (\\n                                    \u003cp className=\\\"text-xs text-muted-foreground\\\"\u003e\\n                                      {DASHBOARD.payouts.originationShare} {parseFloat(p.attributionPercentage)}%\\n                                      {p.relationshipId && (\\n                                        \u003cspan className=\\\"ml-2 text-blue-600\\\"\u003e\\n                                          \u003cLink2 className=\\\"inline w-3 h-3 mr-0.5\\\" /\u003e\\n                                          REL-{p.relationshipId}\\n                                        \u003c/span\u003e\\n                                      )}\\n                                    \u003c/p\u003e\\n                                  )}\\n                                  {p.status === \\\"completed\\\" && p.paidAt && (\\n                                    \u003cp className=\\\"text-xs text-emerald-600\\\"\u003e\\n                                      Paid on {format(new Date(p.paidAt), \\\"MMM d, yyyy\\\")} ({formatDistanceToNow(new Date(p.paidAt), { addSuffix: true })})\\n                                    \u003c/p\u003e\\n                                  )}\\n                                \u003c/div\u003e\\n                                \u003cspan className=\\\"font-data-hud font-bold text-sm text-slate-900\\\"\u003e\\n                                  {fmtCurrency(parseFloat(p.amount))}\\n                                \u003c/span\u003e\\n                              \u003c/div\u003e\\n                            \u003c/div\u003e\\n                          );\\n                        })}\\n                    \u003c/div\u003e\\n                  )}\\n                \u003c/div\u003e\\n              );\\n            })}\\n        \u003c/div\u003e\\n      )}\\n    \u003c/div\u003e\\n  );\\n}\\n\",\n  \"changes_summary\": [\n    \"Added import for DASHBOARD from @/lib/copy.\",\n    \"Updated 'Lifetime Attribution' stat card header to use DASHBOARD.payouts.lifetimeAttribution.\",\n    \"Added 'Attribution Chain' section heading with a subtitle before the 'Deal Payout Timeline' accordion, styled as specified.\",\n    \"Updated the display of attribution percentage within the deal timeline to include DASHBOARD.payouts.originationShare as a label.\"\n  ],\n  \"whitepaper_terms_added\": [\n    \"Attribution Chain\",\n    \"Lifetime Attribution\"\n  ],\n  \"copy_tokens_used\": [\n    \"DASHBOARD.payouts.lifetimeAttribution\",\n    \"DASHBOARD.payouts.originationShare\"\n  ]\n}\n```"
          }
        ],
        "role": "model"
      },
      "finishReason": "STOP",
      "index": 0
    }
  ],
  "usageMetadata": {
    "promptTokenCount": 10705,
    "candidatesTokenCount": 7235,
    "totalTokenCount": 19177,
    "promptTokensDetails": [
      {
        "modality": "TEXT",
        "tokenCount": 10705
      }
    ],
    "thoughtsTokenCount": 1237
  },
  "modelVersion": "gemini-2.5-flash",
  "responseId": "H-ihaYTYIumgz7IPrvSQwQQ"
}
