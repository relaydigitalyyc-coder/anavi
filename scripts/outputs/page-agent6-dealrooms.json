{
  "upgraded_tsx": "import { useState, useMemo, useEffect } from \"react\";\nimport { trpc } from \"@/lib/trpc\";\nimport { EmptyState, EMPTY_STATES } from \"@/components/EmptyState\";\nimport {\n  FolderOpen, Clock, ChevronRight,\n  Lock, Download, Eye\n} from \"lucide-react\";\nimport { useLocation } from \"wouter\";\nimport { FadeInView, ScaleHover, StaggerContainer, StaggerItem } from \"@/components/PageTransition\";\n\ntype StatusFilter = \"all\" | \"nda_pending\" | \"active\" | \"completed\" | \"declined\";\n\nconst STATUS_FILTERS: { key: StatusFilter; label: string; className: string }[] = [\n  { key: \"all\", label: \"All\", className: \"\" },\n  { key: \"nda_pending\", label: \"NDA Pending\", className: \"status-nda-pending\" },\n  { key: \"active\", label: \"Active\", className: \"status-active\" },\n  { key: \"completed\", label: \"Completed\", className: \"status-completed\" },\n  { key: \"declined\", label: \"Declined\", className: \"status-declined\" },\n];\n\nconst BADGE = \"rounded-full px-2 py-0.5 text-[10px] font-bold uppercase tracking-wider\";\n\nfunction getStatusClass(status: string | null): string {\n  switch (status) {\n    case \"active\":\n      return `bg-[#22D4F5]/10 text-[#22D4F5]/80 ${BADGE}`;\n    case \"closed\":\n      return `bg-[#059669]/15 text-[#059669] ${BADGE}`;\n    case \"archived\":\n      return `bg-[#6B7280]/15 text-[#6B7280] ${BADGE}`;\n    default:\n      return `bg-[#F59E0B]/15 text-[#F59E0B] ${BADGE}`;\n  }\n}\n\nfunction getStatusLabel(status: string | null): string {\n  switch (status) {\n    case \"active\": return \"Active\";\n    case \"closed\": return \"Completed\";\n    case \"archived\": return \"Declined\";\n    default: return \"NDA Pending\";\n  }\n}\n\nfunction daysSince(date: Date | string): number {\n  const d = typeof date === \"string\" ? new Date(date) : date;\n  return Math.floor((Date.now() - d.getTime()) / (1000 * 60 * 60 * 24));\n}\n\nfunction formatRelativeTime(date: Date | string): string {\n  const d = typeof date === \"string\" ? new Date(date) : date;\n  const diffMs = Date.now() - d.getTime();\n  const diffMin = Math.floor(diffMs / 60000);\n  if (diffMin < 60) return `${diffMin}m ago`;\n  const diffHr = Math.floor(diffMin / 60);\n  if (diffHr < 24) return `${diffHr}h ago`;\n  const diffDay = Math.floor(diffHr / 24);\n  if (diffDay < 30) return `${diffDay}d ago`;\n  return d.toLocaleDateString();\n}\n\nexport default function DealRooms() {\n  const [, setLocation] = useLocation();\n  const [filter, setFilter] = useState<StatusFilter>(\"all\");\n  const { data: dealRooms, isLoading } = trpc.dealRoom.list.useQuery();\n\n  const stats = useMemo(() => {\n    if (!dealRooms) return { active: 0, pendingNda: 0, completed: 0, total: 0 };\n    return {\n      active: dealRooms.filter(r => r.status === \"active\").length,\n      pendingNda: dealRooms.filter(r => !r.status || r.status === null).length,\n      completed: dealRooms.filter(r => r.status === \"closed\").length,\n      total: dealRooms.length,\n    };\n  }, [dealRooms]);\n\n  const filtered = useMemo(() => {\n    if (!dealRooms) return [];\n    if (filter === \"all\") return dealRooms;\n    const mapping: Record<StatusFilter, (r: any) => boolean> = {\n      all: () => true,\n      nda_pending: r => !r.status || r.status === null,\n      active: r => r.status === \"active\",\n      completed: r => r.status === \"closed\",\n      declined: r => r.status === \"archived\",\n    };\n    return dealRooms.filter(mapping[filter]);\n  }, [dealRooms, filter]);\n\n  useEffect(() => { document.title = \"Deal Rooms | ANAVI\"; }, []);\n\n  return (\n    <div className=\"p-8 space-y-6 animate-fade-in\">\n      {/* Header */}\n      <FadeInView>\n        <h1 className=\"dash-heading text-3xl\">Deal Rooms</h1>\n        {/* Subtitle added */}\n        <p className=\"text-lg text-[#1E3A5F]/80 mt-2\">NDA-gated workspaces. Immutable audit trail active on every room.</p>\n      </FadeInView>\n\n      {/* Stats Row */}\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4\">\n        {[\n          { label: \"Active Rooms\", value: stats.active, color: \"#2563EB\" },\n          { label: \"Pending NDA\", value: stats.pendingNda, color: \"#C4972A\" },\n          { label: \"Completed\", value: stats.completed, color: \"#059669\" },\n          { label: \"Total Rooms\", value: stats.total, color: \"#0A1628\" },\n        ].map((s) => (\n          <div\n            key={s.label}\n            className=\"card-elevated p-5\"\n          >\n            <div className=\"text-label text-muted-foreground mb-1\">{s.label}</div>\n            <div className=\"text-2xl font-bold number-display\" style={{ color: s.color }}>\n              {s.value}\n            </div>\n          </div>\n        ))}\n      </div>\n\n      {/* Filter Bar */}\n      <div className=\"card-elevated p-1.5 flex flex-wrap gap-1\">\n        {STATUS_FILTERS.map((sf) => {\n          const isActive = filter === sf.key;\n          return (\n            <button\n              key={sf.key}\n              onClick={() => setFilter(sf.key)}\n              className={\n                isActive\n                  ? \"rounded-md px-3 py-1.5 text-xs font-semibold bg-[#0A1628] text-white cursor-pointer transition-all\"\n                  : \"rounded-md px-3 py-1.5 text-xs font-medium text-[#1E3A5F]/60 hover:text-[#0A1628] hover:bg-[#0A1628]/5 cursor-pointer transition-all\"\n              }\n            >\n              {sf.label}\n            </button>\n          );\n        })}\n      </div>\n\n      {/* Deal Room Cards */}\n      {isLoading ? (\n        <div className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {[1, 2, 3].map((i) => (\n            <div key={i} className=\"card-elevated p-6\">\n              <div className=\"h-40 animate-shimmer rounded-lg\" />\n            </div>\n          ))}\n        </div>\n      ) : filtered.length === 0 ? (\n        <div className=\"card-elevated p-6\">\n          <EmptyState {...EMPTY_STATES.dealRooms} />\n        </div>\n      ) : (\n        <StaggerContainer className=\"grid md:grid-cols-2 lg:grid-cols-3 gap-4\">\n          {filtered.map((room) => {\n            const settings = (room.settings as any) || {};\n            const days = daysSince(room.createdAt);\n            const lastActivity = formatRelativeTime(room.updatedAt || room.createdAt);\n\n            return (\n              <StaggerItem key={room.id}>\n              <ScaleHover>\n              <div className=\"card-elevated flex flex-col hover:translate-y-[-2px]\">\n                <div className=\"p-5 flex-1 space-y-3\">\n                  {/* Status pill */}\n                  <div className=\"flex justify-end\">\n                    <span className={`inline-flex ${getStatusClass(room.status)}`}>\n                      {getStatusLabel(room.status)}\n                    </span>\n                  </div>\n\n                  {/* Room name */}\n                  <h3 className=\"font-semibold text-base\" style={{ color: \"#0A1628\" }}>\n                    {room.name}\n                  </h3>\n\n                  {/* New text line added */}\n                  <p className=\"text-[10px] text-[#1E3A5F]/50\">Every document access and signature is cryptographically logged.</p>\n\n                  {/* Parties (anonymized) */}\n                  <div className=\"text-sm text-muted-foreground\">\n                    <span className=\"font-medium\">Party A</span>\n                    {\" \u2194 \"}\n                    <span className=\"font-medium\">Party B</span>\n                  </div>\n\n                  {/* Meta row */}\n                  <div className=\"flex flex-wrap items-center gap-x-4 gap-y-1 text-xs text-muted-foreground\">\n                    <span className=\"flex items-center gap-1\">\n                      <Clock className=\"w-3.5 h-3.5\" />\n                      {days}d in room\n                    </span>\n                    <span>Last: <span className=\"font-data-hud text-[10px] text-[#1E3A5F]/50\">{lastActivity}</span></span>\n                  </div>\n\n                  {/* Badges */}\n                  <div className=\"flex flex-wrap gap-1.5 pt-1\">\n                    {room.ndaRequired && (\n                      <span className=\"inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-[11px] font-medium bg-orange-50 text-orange-700\">\n                        <Lock className=\"w-3 h-3\" />\n                        NDA Required\n                      </span>\n                    )}\n                    {settings.watermarkDocuments && (\n                      <span className=\"inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-[11px] font-medium bg-blue-50 text-blue-700\">\n                        <Eye className=\"w-3 h-3\" />\n                        Watermarking\n                      </span>\n                    )}\n                    {settings.allowDownloads === false && (\n                      <span className=\"inline-flex items-center gap-1 rounded-full px-2 py-0.5 text-[11px] font-medium bg-red-50 text-red-700\">\n                        <Download className=\"w-3 h-3\" />\n                        Download Controls\n                      </span>\n                    )}\n                  </div>\n                </div>\n\n                {/* CTA */}\n                <div className=\"px-5 pb-5 pt-2\">\n                  <button\n                    onClick={() => setLocation(`/deal-rooms/${room.id}`)}\n                    className=\"w-full flex items-center justify-center gap-2 rounded-lg px-4 py-2.5 text-sm font-medium text-white transition-colors\"\n                    style={{ background: \"#2563EB\" }}\n                  >\n                    Enter Room\n                    <ChevronRight className=\"w-4 h-4\" />\n                  </button>\n                </div>\n              </div>\n              </ScaleHover>\n              </StaggerItem>\n            );\n          })}\n        </StaggerContainer>\n      )}\n    </div>\n  );\n}\n",
  "changes_summary": [
    "Removed 'Diligence' and 'Closing' status filters from the `STATUS_FILTERS` array and the `StatusFilter` type, aligning with the schema's available statuses.",
    "Updated the `filtered` `useMemo` mapping to correctly filter deal rooms based on the remaining 'all', 'nda_pending', 'active', 'completed', and 'declined' statuses.",
    "Changed the 'Total Value' stat card label to 'Total Rooms' and its displayed value from a calculated monetary amount to the raw count of `stats.total`.",
    "Added a subtitle 'NDA-gated workspaces. Immutable audit trail active on every room.' directly below the main 'Deal Rooms' heading.",
    "Inserted a small text line 'Every document access and signature is cryptographically logged.' below each deal room's name within the deal room cards, styled with `text-[10px] text-[#1E3A5F]/50`."
  ],
  "whitepaper_terms_added": [
    "NDA-gated workspaces",
    "Immutable audit trail",
    "cryptographically logged"
  ],
  "copy_tokens_used": [
    "EMPTY_STATES.dealRooms"
  ]
}