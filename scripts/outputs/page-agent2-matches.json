{
  "upgraded_tsx": "import { trpc } from \"@/lib/trpc\";\nimport { Card, CardContent } from \"@/components/ui/card\";\nimport { Button } from \"@/components/ui/button\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Progress } from \"@/components/ui/progress\";\nimport {\n  Handshake, Heart, X, MessageSquare, Shield,\n  Clock, Sparkles, ArrowRight, CheckCircle2, Zap, Lock\n} from \"lucide-react\";\nimport { toast } from \"sonner\";\nimport { useLocation } from \"wouter\";\nimport { useAuth } from \"@/_core/hooks/useAuth\";\nimport { FadeInView, StaggerContainer, StaggerItem } from \"@/components/PageTransition\";\nimport { DASHBOARD } from \"@/lib/copy\";\n\nexport default function Matches() {\n  const [, setLocation] = useLocation();\n  const { user } = useAuth(); // Get current user\n  const { data: matches, isLoading, refetch } = trpc.match.list.useQuery();\n  \n  const expressInterestMutation = trpc.match.expressInterest.useMutation({\n    onSuccess: (data) => {\n      if (data.mutualInterest) {\n        toast.success(\"Mutual interest! You can now create a deal room.\");\n      } else {\n        toast.success(\"Interest expressed. Waiting for counterparty response.\");\n      }\n      refetch();\n    },\n    onError: (error) => {\n      toast.error(error.message);\n    },\n  });\n\n  const createDealRoomMutation = trpc.match.createDealRoom.useMutation({\n    onSuccess: () => {\n      toast.success(\"Deal room created!\");\n      setLocation(\"/deal-rooms\");\n    },\n    onError: (error) => {\n      toast.error(error.message);\n    },\n  });\n\n  const getStatusStyle = (status: string) => {\n    switch (status) {\n      case \"pending\": return \"bg-sky-100 text-sky-700\";\n      case \"user1_interested\": \n      case \"user2_interested\": return \"bg-blue-100 text-blue-700\";\n      case \"mutual_interest\": return \"bg-sky-100 text-sky-700\";\n      case \"deal_room_created\": return \"bg-[#059669]/15 text-[#059669]\"; // Trust green for active deal room\n      case \"declined\": return \"bg-red-100 text-red-700\";\n      default: return \"bg-muted text-muted-foreground\";\n    }\n  };\n\n  const getStatusLabel = (status: string, isUser1: boolean) => {\n    switch (status) {\n      case \"pending\": return \"Awaiting Response\";\n      case \"user1_interested\": return isUser1 ? \"You Expressed Interest\" : \"They're Interested\";\n      case \"user2_interested\": return !isUser1 ? \"You Expressed Interest\" : \"They're Interested\";\n      case \"mutual_interest\": return \"Mutual Interest!\";\n      case \"deal_room_created\": return \"Deal Room Active\";\n      case \"declined\": return \"Declined\";\n      default: return status;\n    }\n  };\n\n  return (\n    <FadeInView className=\"p-8 space-y-8\">\n      {/* Header */}\n      <div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4\">\n        <div>\n          <h1 className=\"text-3xl font-bold tracking-tight flex items-center gap-3\">\n            <div className=\"w-10 h-10 rounded-xl bg-rose-50 flex items-center justify-center\">\n              <Handshake className=\"w-5 h-5 text-rose-600\" />\n            </div>\n            {DASHBOARD.blindMatches.title}\n          </h1>\n          <p className=\"text-muted-foreground mt-2\">\n            Intents expressed anonymously. Counterparty identity sealed until mutual consent.\n          </p>\n        </div>\n      </div>\n\n      {/* Stats */}\n      <div className=\"grid grid-cols-2 md:grid-cols-4 gap-6\">\n        <Card className=\"card-elevated\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <div className=\"text-sm font-medium text-muted-foreground mb-1\">{DASHBOARD.blindMatches.title}</div>\n                <div className=\"text-3xl font-bold font-data-hud\">{matches?.length || 0}</div>\n              </div>\n              <div className=\"w-12 h-12 rounded-xl bg-rose-50 flex items-center justify-center\">\n                <Handshake className=\"w-6 h-6 text-rose-600\" />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n        <Card className=\"card-elevated\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <div className=\"text-sm font-medium text-muted-foreground mb-1\">Pending</div>\n                <div className=\"text-3xl font-bold font-data-hud text-sky-600\">\n                  {matches?.filter(m => m.status === 'pending').length || 0}\n                </div>\n              </div>\n              <div className=\"w-12 h-12 rounded-xl bg-sky-50 flex items-center justify-center\">\n                <Clock className=\"w-6 h-6 text-sky-600\" />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n        <Card className=\"card-elevated\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <div className=\"text-sm font-medium text-muted-foreground mb-1\">Mutual Interest</div>\n                <div className=\"text-3xl font-bold font-data-hud text-sky-600\">\n                  {matches?.filter(m => m.status === 'mutual_interest').length || 0}\n                </div>\n              </div>\n              <div className=\"w-12 h-12 rounded-xl bg-sky-50 flex items-center justify-center\">\n                <Heart className=\"w-6 h-6 text-sky-600\" />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n        <Card className=\"card-elevated\">\n          <CardContent className=\"p-6\">\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <div className=\"text-sm font-medium text-muted-foreground mb-1\">Deal Rooms</div>\n                <div className=\"text-3xl font-bold font-data-hud text-[#C4972A]\">\n                  {matches?.filter(m => m.status === 'deal_room_created').length || 0}\n                </div>\n              </div>\n              <div className=\"w-12 h-12 rounded-xl bg-[#C4972A]/10 flex items-center justify-center\">\n                <Zap className=\"w-6 h-6 text-[#C4972A]\" />\n              </div>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n\n      {/* Matches List */}\n      {isLoading ? (\n        <div className=\"grid gap-4\">\n          {[1, 2, 3].map((i) => (\n            <Card key={i} className=\"card-elevated\">\n              <CardContent className=\"p-6\">\n                <div className=\"h-40 animate-shimmer rounded-xl\" />\n              </CardContent>\n            </Card>\n          ))}\n        </div>\n      ) : !matches || matches.length === 0 ? (\n        <Card className=\"card-elevated\">\n          <CardContent className=\"p-16 text-center\">\n            <div className=\"w-20 h-20 rounded-full bg-muted flex items-center justify-center mx-auto mb-6\">\n              <Sparkles className=\"w-10 h-10 text-muted-foreground\" />\n            </div>\n            <h3 className=\"text-xl font-semibold mb-2\">No Blind Matches Yet</h3>\n            <p className=\"text-muted-foreground mb-6 max-w-sm mx-auto\">\n              Express an intent to activate matching and find compatible counterparties.\n            </p>\n            <Button onClick={() => setLocation(\"/intents\")} className=\"btn-gold\">\n              Create Intent\n            </Button>\n          </CardContent>\n        </Card>\n      ) : (\n        <StaggerContainer className=\"grid gap-4\">\n          {matches.map((match, index) => {\n            // TODO: derive from match.user1Id and user.id. Assuming match has user1Id and user2Id.\n            // If match.user1Id or match.user2Id are not directly available, this will need adjustment.\n            const isUser1 = user?.id === match.user1Id; // Derived isUser1\n            const hasExpressedInterest = isUser1 ? match.user1Consent : match.user2Consent;\n            const compatibilityScore = parseFloat(match.compatibilityScore || \"0\");\n\n            return (\n              <StaggerItem key={match.id}>\n                <Card \n                  className=\"card-elevated relative overflow-hidden bg-gradient-to-br from-[#0A1628]/5 to-transparent\"\n                >\n                  <Badge className=\"absolute top-4 left-4 bg-[#C4972A] text-white font-semibold\">\n                    SEALED -- {match.assetClass || 'AssetClass'}\n                  </Badge>\n                  <Lock className=\"absolute top-4 right-4 w-5 h-5 text-[#C4972A]\" />\n\n                  <CardContent className=\"p-6 pt-16\"> {/* Adjusted padding for badge/lock */}\n                    <div className=\"flex flex-col lg:flex-row lg:items-start justify-between gap-6\">\n                      {/* Match Info */}\n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center gap-3 mb-4\">\n                          <Badge className={`${getStatusStyle(match.status || 'pending')} border-0`}>\n                            {getStatusLabel(match.status || 'pending', isUser1)}\n                          </Badge>\n                          <span className=\"text-sm text-muted-foreground font-data-mono\">\n                            Match #{match.id}\n                          </span>\n                        </div>\n\n                        {/* Compatibility Score */}\n                        <div className=\"mb-5\">\n                          <div className=\"flex items-center justify-between mb-2\">\n                            <span className=\"text-sm font-medium\">Match Compatibility</span>\n                            <span className=\"text-xl font-bold font-data-hud text-[#C4972A]\">{compatibilityScore}%</span>\n                          </div>\n                          <Progress value={compatibilityScore} className=\"h-2 bg-gray-700\" indicatorClassName=\"bg-[#C4972A]\" />\n                        </div>\n\n                        {/* Match Reason */}\n                        {match.matchReason && (\n                          <div className=\"p-4 rounded-xl bg-gradient-to-r from-[#0A1628]/5 to-transparent border border-[#1E3A5F] mb-5\">\n                            <div className=\"flex items-center gap-2 text-sm font-semibold mb-2 text-[#C4972A]\">\n                              <Sparkles className=\"w-4 h-4 text-[#C4972A]\" />\n                              AI Analysis\n                            </div>\n                            <p className=\"text-sm text-muted-foreground leading-relaxed\">{match.matchReason}</p>\n                          </div>\n                        )}\n\n                        {/* Intent Details */}\n                        <div className=\"grid md:grid-cols-2 gap-4\">\n                          <div className=\"p-4 rounded-xl border border-[#1E3A5F] bg-[#0A1628]/10\">\n                            <div className=\"text-xs text-muted-foreground mb-1 font-medium\">Your Intent</div>\n                            <div className=\"font-semibold font-data-mono\">Intent #{match.intent1Id}</div>\n                          </div>\n                          <div className=\"p-4 rounded-xl border border-[#1E3A5F] bg-[#0A1628]/10\">\n                            <div className=\"text-xs text-muted-foreground mb-1 font-medium\">Their Intent</div>\n                            <div className=\"font-semibold font-data-mono\">Intent #{match.intent2Id}</div>\n                            {match.status === 'mutual_interest' || match.status === 'deal_room_created' ? (\n                              <Badge className=\"mt-2 bg-[#059669]/15 text-[#059669] hover:bg-[#059669]/15 border-0\">\n                                <Shield className=\"w-3 h-3 mr-1\" />\n                                Verified\n                              </Badge>\n                            ) : (\n                              <Badge variant=\"secondary\" className=\"mt-2 bg-[#1E3A5F]/15 text-[#1E3A5F]\">\n                                Anonymous\n                              </Badge>\n                            )}\n                            <div className=\"flex items-center gap-2 mt-2 text-xs text-muted-foreground\">\n                              <Shield className=\"w-3 h-3 text-[#1E3A5F]\" />\n                              <span className=\"capitalize font-data-mono\">{(match as any).counterpartyVerificationTier ?? \"none\"}</span>\n                              <span className=\"text-muted-foreground/50\">|</span>\n                              <span className=\"font-data-hud\">{(match as any).counterpartyDealCount ?? 0} deals</span>\n                            </div>\n                          </div>\n                        </div>\n\n                        {/* Timestamps */}\n                        <div className=\"flex items-center gap-4 mt-4 text-sm text-muted-foreground\">\n                          <div className=\"flex items-center gap-2\">\n                            <Clock className=\"w-4 h-4\" />\n                            <span>Matched {new Date(match.createdAt).toLocaleDateString()}</span>\n                          </div>\n                        </div>\n                      </div>\n\n                      {/* Actions */}\n                      <div className=\"flex flex-col gap-2 lg:w-48\">\n                        {match.status === 'pending' && (\n                          <>\n                            <Button\n                              onClick={() => expressInterestMutation.mutate({ matchId: match.id })}\n                              disabled={expressInterestMutation.isPending}\n                              className=\"btn-gold\"\n                            >\n                              <Heart className=\"w-4 h-4 mr-2\" />\n                              Express Interest\n                            </Button>\n                            <Button variant=\"outline\" className=\"hover:border-red-300 hover:text-red-600\">\n                              <X className=\"w-4 h-4 mr-2\" />\n                              Decline\n                            </Button>\n                          </>\n                        )}\n\n                        {(match.status === 'user1_interested' || match.status === 'user2_interested') && !hasExpressedInterest && (\n                          <>\n                            <Button\n                              onClick={() => expressInterestMutation.mutate({ matchId: match.id })}\n                              disabled={expressInterestMutation.isPending}\n                              className=\"btn-gold\"\n                            >\n                              <Heart className=\"w-4 h-4 mr-2\" />\n                              Express Interest\n                            </Button>\n                            <Button variant=\"outline\" className=\"hover:border-red-300 hover:text-red-600\">\n                              <X className=\"w-4 h-4 mr-2\" />\n                              Decline\n                            </Button>\n                          </>\n                        )}\n\n                        {(match.status === 'user1_interested' || match.status === 'user2_interested') && hasExpressedInterest && (\n                          <div className=\"text-center p-5 rounded-xl bg-[#1E3A5F]/30 border border-[#1E3A5F]\">\n                            <CheckCircle2 className=\"w-8 h-8 mx-auto text-[#C4972A] mb-2\" />\n                            <p className=\"text-sm font-medium text-white\">Waiting for response...</p>\n                          </div>\n                        )}\n\n                        {match.status === 'mutual_interest' && (\n                          <>\n                            <Button\n                              onClick={() => createDealRoomMutation.mutate({ matchId: match.id })}\n                              disabled={createDealRoomMutation.isPending}\n                              className=\"btn-gold\"\n                            >\n                              <ArrowRight className=\"w-4 h-4 mr-2\" />\n                              Create Deal Room\n                            </Button>\n                            <Button variant=\"outline\" className=\"hover:border-primary hover:text-primary\">\n                              <MessageSquare className=\"w-4 h-4 mr-2\" />\n                              Message\n                            </Button>\n                          </>\n                        )}\n\n                        {match.status === 'deal_room_created' && match.dealRoomId && (\n                          <Button\n                            onClick={() => setLocation(\"/deal-rooms\")}\n                            className=\"btn-gold\"\n                          >\n                            <ArrowRight className=\"w-4 h-4 mr-2\" />\n                            Go to Deal Room\n                          </Button>\n                        )}\n                      </div>\n                    </div>\n                  </CardContent>\n                </Card>\n              </StaggerItem>\n            );\n          })}\n        </StaggerContainer>\n      )}\n    </FadeInView>\n  );\n}\n",
  "changes_summary": [
    "Changed page heading from 'AI Matches' to 'Blind Matches' using `DASHBOARD.blindMatches.title`.",
    "Updated header description to reflect 'Blind Matching' concept: 'Intents expressed anonymously. Counterparty identity sealed until mutual consent.'",
    "Changed 'Total Matches' stat card label to 'Blind Matches' using `DASHBOARD.blindMatches.title`.",
    "Applied `card-elevated` class to all `Card` components for consistent styling.",
    "Applied `font-data-hud` class to all numerical displays in stat cards and compatibility scores.",
    "Applied `font-data-mono` class to match IDs, intent IDs, and counterparty verification details.",
    "Replaced `animate-fade-in` with `FadeInView` for page transition.",
    "Wrapped the matches list with `StaggerContainer` and individual match cards with `StaggerItem` for staggered animations.",
    "Added `relative` positioning, `bg-gradient-to-br from-[#0A1628]/5 to-transparent` gradient, 'SEALED -- [AssetClass]' gold badge, and a gold `Lock` icon to each match card for the 'sealed brief' aesthetic.",
    "Adjusted `CardContent` padding to `pt-16` to accommodate the new badge and lock icon.",
    "Derived `isUser1` dynamically using `useAuth` and `match.user1Id` instead of hardcoding `true`.",
    "Changed 'Compatibility Score' label to 'Match Compatibility'.",
    "Updated compatibility score percentage color to gold (`#C4972A`) and progress bar indicator to gold.",
    "Updated colors for 'AI Analysis' section (background, border, text, icon) to align with ANAVI palette (`#0A1628`, `#1E3A5F`, `#C4972A`).",
    "Updated colors for 'Waiting for response...' box (background, border, icon, text) to align with ANAVI palette (`#1E3A5F`, `#C4972A`).",
    "Applied `btn-gold` class to primary action buttons ('Express Interest', 'Create Deal Room', 'Go to Deal Room').",
    "Updated 'Deal Rooms' stat card icon background and text color to gold (`#C4972A`).",
    "Updated `deal_room_created` status badge style to use trust green (`#059669`).",
    "Updated empty state message to 'No Blind Matches Yet' and 'Express an intent to activate matching and find compatible counterparties.'"
  ],
  "whitepaper_terms_added": [
    "Blind Matching",
    "Sealed Match Results",
    "Blind Intent",
    "Mutual Consent"
  ],
  "copy_tokens_used": [
    "DASHBOARD.blindMatches.title"
  ]
}