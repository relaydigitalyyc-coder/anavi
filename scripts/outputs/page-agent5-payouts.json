{
  "upgraded_tsx": "import { useState, useMemo, useEffect } from \"react\";\nimport { trpc } from \"@/lib/trpc\";\nimport { Badge } from \"@/components/ui/badge\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { EmptyState, EMPTY_STATES } from \"@/components/EmptyState\";\nimport { FadeInView } from \"@/components/PageTransition\";\nimport { SmoothCounter } from \"@/components/PremiumAnimations\";\nimport {\n  Select,\n  SelectContent,\n  SelectItem,\n  SelectTrigger,\n  SelectValue,\n} from \"@/components/ui/select\";\nimport {\n  Wallet,\n  AlertCircle,\n  ChevronDown,\n  ChevronRight,\n  Link2,\n  Download,\n  FileText,\n} from \"lucide-react\";\nimport { format, formatDistanceToNow } from \"date-fns\";\nimport { toast } from \"sonner\";\nimport { DASHBOARD } from \"@/lib/copy\";\n\n\nconst fmtCurrency = (amount: number) =>\n  new Intl.NumberFormat(\"en-US\", { style: \"currency\", currency: \"USD\" }).format(\n    amount,\n  );\n\ntype PayoutStatus = \"all\" | \"pending\" | \"processing\" | \"completed\" | \"failed\";\ntype PayoutTypeFilter =\n  | \"all\"\n  | \"originator_fee\"\n  | \"introducer_fee\"\n  | \"advisor_fee\"\n  | \"milestone_bonus\"\n  | \"success_fee\";\n\nconst STATUS_OPTIONS: { value: PayoutStatus; label: string }[] = [\n  { value: \"all\", label: \"All\" },\n  { value: \"pending\", label: \"Pending\" },\n  { value: \"processing\", label: \"Processing\" },\n  { value: \"completed\", label: \"Completed\" },\n  { value: \"failed\", label: \"Failed\" },\n];\n\nconst TYPE_OPTIONS: { value: PayoutTypeFilter; label: string }[] = [\n  { value: \"all\", label: \"All\" },\n  { value: \"originator_fee\", label: \"Originator Fee\" },\n  { value: \"introducer_fee\", label: \"Introducer Fee\" },\n  { value: \"advisor_fee\", label: \"Advisor Fee\" },\n  { value: \"milestone_bonus\", label: \"Milestone Bonus\" },\n  { value: \"success_fee\", label: \"Success Fee\" },\n];\n\nfunction getTypeLabel(type: string) {\n  return (\n    TYPE_OPTIONS.find((t) => t.value === type)?.label ??\n    type.replace(/_/g, \" \")\n  );\n}\n\nfunction getTypeBadgeClasses(type: string): string {\n  switch (type) {\n    case \"originator_fee\":\n      return \"bg-slate-900 text-white\";\n    case \"introducer_fee\":\n      return \"bg-blue-600 text-white\";\n    case \"advisor_fee\":\n      return \"bg-[#C4972A] text-white\";\n    case \"milestone_bonus\":\n      return \"bg-emerald-600 text-white\";\n    case \"success_fee\":\n      return \"bg-violet-600 text-white\";\n    default:\n      return \"\";\n  }\n}\n\nfunction PayoutStatementSection() {\n  const [periodStart, setPeriodStart] = useState(() =>\n    format(new Date(new Date().getFullYear(), new Date().getMonth(), 1), \"yyyy-MM-dd\")\n  );\n  const [periodEnd, setPeriodEnd] = useState(() => format(new Date(), \"yyyy-MM-dd\"));\n  const [showModal, setShowModal] = useState(false);\n\n  const { data: statement, isLoading } = trpc.payout.getStatement.useQuery(\n    {\n      periodStart: `${periodStart}T00:00:00.000Z`,\n      periodEnd: `${periodEnd}T23:59:59.999Z`,\n    },\n    { enabled: showModal && !!periodStart && !!periodEnd }\n  );\n\n  const downloadCSV = () => {\n    if (!statement) return;\n    const header = \"Deal ID,Amount,Currency,Type,Status,Date\\n\";\n    const rows = statement.items.map(\n      (p: any) =>\n        `${p.dealId ?? \"\"},${p.amount ?? 0},${p.currency ?? \"USD\"},${p.payoutType ?? \"\"},${p.status ?? \"\"},\"${new Date(p.createdAt).toLocaleDateString()}\"`\n    ).join(\"\\n\");\n    const blob = new Blob([header + rows], { type: \"text/csv\" });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement(\"a\");\n    a.href = url;\n    a.download = `ANAVI-Payout-Statement-${periodStart}-${periodEnd}.csv`;\n    a.click();\n    URL.revokeObjectURL(url);\n    toast.success(\"Statement downloaded\");\n  };\n\n  return (\n    <div className=\"card-elevated p-6\">\n      <h3 className=\"data-label mb-2 text-slate-900\">\n        Payout Statement\n      </h3>\n      <p className=\"text-sm text-muted-foreground mb-4\">\n        Official ANAVI payout statement. Select a period and view or download.\n      </p>\n      <div className=\"flex flex-wrap gap-3 items-end\">\n        <div className=\"space-y-1\">\n          <label className=\"text-xs font-semibold uppercase text-muted-foreground\">Start</label>\n          <Input\n            type=\"date\"\n            value={periodStart}\n            onChange={(e) => setPeriodStart(e.target.value)}\n            className=\"w-[160px]\"\n          />\n        </div>\n        <div className=\"space-y-1\">\n          <label className=\"text-xs font-semibold uppercase text-muted-foreground\">End</label>\n          <Input\n            type=\"date\"\n            value={periodEnd}\n            onChange={(e) => setPeriodEnd(e.target.value)}\n            className=\"w-[160px]\"\n          />\n        </div>\n        <Button\n          className=\"btn-gold gap-2\"\n          onClick={() => setShowModal(true)}\n        >\n          <FileText className=\"w-4 h-4\" />\n          View Statement\n        </Button>\n      </div>\n      {showModal && (\n        <div className=\"fixed inset-0 z-50 flex items-center justify-center\">\n          <div className=\"absolute inset-0 bg-black/50\" onClick={() => setShowModal(false)} />\n          <div className=\"relative z-10 bg-white rounded-xl shadow-xl max-w-lg w-full mx-4 max-h-[80vh] overflow-hidden\">\n            <div className=\"p-6 border-b border-slate-200\">\n              <h4 className=\"text-lg font-semibold text-slate-900\">\n                Official ANAVI Payout Statement\n              </h4>\n              <p className=\"text-sm text-muted-foreground mt-1\">\n                {periodStart} \u2014 {periodEnd} \u00b7 Generated {format(new Date(), \"PP\")}\n              </p>\n            </div>\n            <div className=\"p-6 overflow-y-auto max-h-[50vh]\">\n              {isLoading ? (\n                <p className=\"text-sm text-muted-foreground\">Loading\u2026</p>\n              ) : !statement || statement.items.length === 0 ? (\n                <p className=\"text-sm text-muted-foreground\">\n                  No payouts in this period. Select a different range.\n                </p>\n              ) : (\n                <div className=\"space-y-3\">\n                  {statement.items.map((p: any, i: number) => (\n                    <div key={i} className=\"flex justify-between py-2 border-b border-slate-200\">\n                      <span className=\"text-sm\">Deal #{p.dealId}</span>\n                      <span className=\"font-data-hud font-semibold\">\n                        {fmtCurrency(Number(p.amount ?? 0))}\n                      </span>\n                    </div>\n                  ))}\n                  <div className=\"flex justify-between pt-3 font-bold text-base text-slate-900\">\n                    <span>Total</span>\n                    <span>{fmtCurrency(statement.total ?? 0)}</span>\n                  </div>\n                </div>\n              )}\n            </div>\n            <div className=\"p-6 border-t border-slate-200 flex justify-between\">\n              <Button variant=\"outline\" onClick={() => setShowModal(false)}>\n                Close\n              </Button>\n              <Button className=\"btn-gold gap-2\" onClick={downloadCSV} disabled={!statement || statement.items.length === 0}>\n                <Download className=\"w-4 h-4\" />\n                Download CSV\n              </Button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction getStatusPillClasses(status: string) {\n  switch (status) {\n    case \"pending\":\n      return \"bg-orange-100 text-orange-700\";\n    case \"processing\":\n      return \"bg-blue-100 text-blue-700\";\n    case \"completed\":\n      return \"bg-emerald-100 text-emerald-700\";\n    case \"failed\":\n      return \"bg-red-100 text-red-700\";\n    default:\n      return \"bg-gray-100 text-gray-600\";\n  }\n}\n\nfunction buildMonthOptions() {\n  const now = new Date();\n  const opts: { value: string; label: string }[] = [\n    { value: \"all\", label: \"All Time\" },\n  ];\n  for (let i = 0; i < 12; i++) {\n    const d = new Date(now.getFullYear(), now.getMonth() - i, 1);\n    opts.push({\n      value: `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, \"0\")}`,\n      label: format(d, \"MMMM yyyy\"),\n    });\n  }\n  return opts;\n}\n\nexport default function Payouts() {\n  const { data: payouts, isLoading } = trpc.payout.list.useQuery();\n  useEffect(() => { document.title = \"Payouts | ANAVI\"; }, []);\n\n  const [statusFilter, setStatusFilter] = useState<PayoutStatus>(\"all\");\n  const [typeFilter, setTypeFilter] = useState<PayoutTypeFilter>(\"all\");\n  const [monthFilter, setMonthFilter] = useState(\"all\");\n  const [expandedDeal, setExpandedDeal] = useState<number | null>(null);\n\n  const monthOptions = useMemo(buildMonthOptions, []);\n\n  const completedPayouts = useMemo(\n    () => payouts?.filter((p) => p.status === \"completed\") ?? [],\n    [payouts],\n  );\n\n  const totalEarnings = useMemo(\n    () => completedPayouts.reduce((s, p) => s + parseFloat(p.amount), 0),\n    [completedPayouts],\n  );\n\n  const pendingAmount = useMemo(\n    () =>\n      (payouts ?? [])\n        .filter((p) => p.status === \"pending\" || p.status === \"processing\")\n        .reduce((s, p) => s + parseFloat(p.amount), 0),\n    [payouts],\n  );\n\n  const thisMonthEarnings = useMemo(() => {\n    const now = new Date();\n    return (payouts ?? [])\n      .filter((p) => {\n        if (p.status !== \"completed\") return false;\n        const d = new Date(p.paidAt ?? p.createdAt);\n        return (\n          d.getMonth() === now.getMonth() &&\n          d.getFullYear() === now.getFullYear()\n        );\n      })\n      .reduce((s, p) => s + parseFloat(p.amount), 0);\n  }, [payouts]);\n\n  const completedDealCount = useMemo(\n    () => new Set(completedPayouts.map((p) => p.dealId)).size,\n    [completedPayouts],\n  );\n\n  const filteredPayouts = useMemo(() => {\n    if (!payouts) return [];\n    return payouts.filter((p) => {\n      if (statusFilter !== \"all\" && p.status !== statusFilter) return false;\n      if (typeFilter !== \"all\" && p.payoutType !== typeFilter) return false;\n      if (monthFilter !== \"all\") {\n        const d = new Date(p.createdAt);\n        const key = `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, \"0\")}`;\n        if (key !== monthFilter) return false;\n      }\n      return true;\n    });\n  }, [payouts, statusFilter, typeFilter, monthFilter]);\n\n  const dealGroups = useMemo(() => {\n    if (!payouts) return [];\n    const map = new Map<\n      number,\n      { dealId: number; payouts: typeof payouts; total: number }\n    >();\n    for (const p of payouts) {\n      if (!map.has(p.dealId))\n        map.set(p.dealId, { dealId: p.dealId, payouts: [], total: 0 });\n      const g = map.get(p.dealId)!;\n      g.payouts.push(p);\n      g.total += parseFloat(p.amount);\n    }\n    return Array.from(map.values()).sort((a, b) => b.total - a.total);\n  }, [payouts]);\n\n  if (isLoading) {\n    return (\n      <div className=\"p-8 space-y-6\">\n        <div className=\"h-8 w-56 rounded-lg animate-pulse bg-slate-50\" />\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n          {[1, 2, 3, 4].map((i) => (\n            <div key={i} className=\"h-32 rounded-xl animate-pulse bg-slate-50\" />\n          ))}\n        </div>\n        <div className=\"h-48 rounded-xl animate-pulse bg-slate-50\" />\n        <div className=\"h-64 rounded-xl animate-pulse bg-slate-50\" />\n      </div>\n    );\n  }\n\n  const empty = !payouts || payouts.length === 0;\n\n  return (\n    <div className=\"p-8 space-y-8\">\n      {/* \u2500\u2500 Page Header \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 */}\n      <FadeInView>\n      <div>\n        <h1 className=\"text-display tracking-tight flex items-center gap-3 text-slate-900\">\n          <div className=\"w-10 h-10 rounded-xl flex items-center justify-center bg-slate-50\">\n            <Wallet className=\"w-5 h-5 text-blue-600\" />\n          </div>\n          Payouts &amp; Earnings\n        </h1>\n        <p className=\"text-muted-foreground mt-2\">\n          Track your earnings from deal origination and introductions\n        </p>\n      </div>\n      </FadeInView>\n\n      {/* \u2500\u2500 Attribution Summary Hero \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 */}\n      <div className=\"card-elevated p-6 mb-6\">\n        <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6\">\n          {/* Total Earnings (Lifetime Attribution) */}\n          <div>\n            <p className=\"data-label mb-1\">{DASHBOARD.payouts.lifetimeAttribution}</p>\n            <p className=\"font-data-hud text-3xl font-bold text-emerald-600\">\n              $<SmoothCounter value={totalEarnings} duration={1.2} />\n            </p>\n          </div>\n          {/* Next Payout (Pending Amount) */}\n          <div>\n            <p className=\"data-label mb-1\">Next Payout</p>\n            <p className=\"font-data-hud text-3xl font-bold text-slate-900\">\n              $<SmoothCounter value={pendingAmount} duration={1} />\n            </p>\n          </div>\n          {/* Pending Count */}\n          <div>\n            <p className=\"data-label mb-1\">Pending</p>\n            <p className=\"font-data-hud text-3xl font-bold text-[#C4972A]\">\n              <SmoothCounter value={(payouts ?? []).filter((p) => p.status === \"pending\" || p.status === \"processing\").length} duration={1} />\n            </p>\n          </div>\n          {/* This Month */}\n          <div>\n            <p className=\"data-label mb-1\">This Month</p>\n            <p className=\"font-data-hud text-3xl font-bold text-blue-600\">\n              $<SmoothCounter value={thisMonthEarnings} duration={1} />\n            </p>\n          </div>\n        </div>\n      </div>\n\n      {/* F7: Payout Statement */}\n      <PayoutStatementSection />\n\n      {/* \u2500\u2500 Economics Overview \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 */}\n      <div className=\"card-elevated p-6 space-y-5\">\n          <h3 className=\"text-lg font-semibold text-slate-900\">\n            ANAVI Economics Model\n          </h3>\n          <div className=\"flex gap-1 h-8 rounded-lg overflow-hidden\">\n            <div\n              className=\"flex items-center justify-center text-xs font-semibold text-white bg-slate-900\"\n              style={{ flex: \"50 0 0%\" }}\n            >\n              Originator 40\u201360%\n            </div>\n            <div\n              className=\"flex items-center justify-center text-xs font-semibold text-white bg-blue-600\"\n              style={{ flex: \"25 0 0%\" }}\n            >\n              Contributors 20\u201330%\n            </div>\n            <div\n              className=\"flex items-center justify-center text-xs font-semibold text-white bg-[#C4972A]\"\n              style={{ flex: \"15 0 0%\" }}\n            >\n              Platform 10\u201320%\n            </div>\n          </div>\n          <p className=\"text-sm text-muted-foreground leading-relaxed\">\n            When deals close through ANAVI, payouts are automated. Originators receive the largest share \u2014 guaranteed at close.\n          </p>\n      </div>\n\n      {/* \u2500\u2500 Attribution History \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 */}\n      <div className=\"card-elevated p-6 space-y-6\">\n        <h3 className=\"data-label text-slate-900\">\n          Attribution History\n        </h3>\n          {/* Filter Bar */}\n          <div className=\"flex flex-wrap gap-3\">\n            <Select\n              value={statusFilter}\n              onValueChange={(v) => setStatusFilter(v as PayoutStatus)}\n            >\n              <SelectTrigger className=\"w-[150px]\">\n                <SelectValue placeholder=\"Status\" />\n              </SelectTrigger>\n              <SelectContent>\n                {STATUS_OPTIONS.map((o) => (\n                  <SelectItem key={o.value} value={o.value}>\n                    {o.label}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n\n            <Select\n              value={typeFilter}\n              onValueChange={(v) => setTypeFilter(v as PayoutTypeFilter)}\n            >\n              <SelectTrigger className=\"w-[180px]\">\n                <SelectValue placeholder=\"Type\" />\n              </SelectTrigger>\n              <SelectContent>\n                {TYPE_OPTIONS.map((o) => (\n                  <SelectItem key={o.value} value={o.value}>\n                    {o.label}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n\n            <Select value={monthFilter} onValueChange={setMonthFilter}>\n              <SelectTrigger className=\"w-[180px]\">\n                <SelectValue placeholder=\"Date Range\" />\n              </SelectTrigger>\n              <SelectContent>\n                {monthOptions.map((o) => (\n                  <SelectItem key={o.value} value={o.value}>\n                    {o.label}\n                  </SelectItem>\n                ))}\n              </SelectContent>\n            </Select>\n          </div>\n\n          {/* Payout Table */}\n          {empty ? (\n            <div className=\"py-12\">\n              <EmptyState {...EMPTY_STATES.payouts} />\n            </div>\n          ) : filteredPayouts.length === 0 ? (\n            <div className=\"text-center py-12\">\n              <AlertCircle className=\"w-10 h-10 mx-auto mb-3 text-muted-foreground\" />\n              <p className=\"text-muted-foreground\">No payouts match the selected filters.</p>\n            </div>\n          ) : (\n            <div className=\"flex flex-col gap-3\">\n              {filteredPayouts.map((p) => (\n                <div\n                  key={p.id}\n                  className=\"card-elevated px-4 py-3 flex items-center justify-between hover:translate-y-[-1px] transition-transform\"\n                >\n                  <div>\n                    <p className=\"font-data-hud text-base font-semibold text-slate-900\">\n                      {fmtCurrency(parseFloat(p.amount))}\n                    </p>\n                    <p className=\"data-label mt-0.5\">{getTypeLabel(p.payoutType)}</p>\n                  </div>\n                  <div className=\"flex items-center gap-3 flex-wrap\">\n                    <span className=\"font-medium text-sm text-blue-600\">\n                      Deal&nbsp;#{p.dealId}\n                    </span>\n                    <span className=\"data-label\">{format(new Date(p.createdAt), \"MMM d\")}</span>\n                    <Badge className={`${getStatusPillClasses(p.status ?? \"pending\")} border-0 text-[11px]`}>\n                      {p.status ?? \"pending\"}\n                    </Badge>\n                    {p.relationshipId && (\n                      <span className=\"inline-flex items-center gap-1 text-xs text-blue-600\">\n                        <Link2 className=\"w-3 h-3\" />\n                        REL-{p.relationshipId}\n                      </span>\n                    )}\n                    {p.isFollowOn && (\n                      <span className=\"text-[10px] font-semibold px-1.5 py-0.5 rounded bg-blue-50 text-blue-600\">\n                        Follow-on\n                      </span>\n                    )}\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n      </div>\n\n      {/* \u2500\u2500 Deal Payout Timeline \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500 */}\n      {!empty && dealGroups.length > 0 && (\n        <div className=\"card-elevated p-6 space-y-6\">\n          <h3 className=\"mb-2 text-sm font-semibold uppercase tracking-wide text-[#1E3A5F]\">\n            Attribution Chain\n          </h3>\n          <p className=\"text-sm text-muted-foreground mb-4\">\n            Every credit in this chain is cryptographically linked to your origination event.\n          </p>\n          <h3 className=\"data-label text-slate-900\">\n            Deal Payout Timeline\n          </h3>\n            {dealGroups.map((group) => {\n              const isExpanded = expandedDeal === group.dealId;\n              return (\n                <div key={group.dealId} className=\"card-elevated p-4\">\n                  {/* Deal header */}\n                  <button\n                    type=\"button\"\n                    className=\"w-full flex items-center justify-between gap-4 text-left\"\n                    onClick={() => setExpandedDeal(isExpanded ? null : group.dealId)}\n                  >\n                    <div className=\"flex items-center gap-3 min-w-0\">\n                      {isExpanded ? (\n                        <ChevronDown className=\"w-5 h-5 shrink-0 text-slate-900\" />\n                      ) : (\n                        <ChevronRight className=\"w-5 h-5 shrink-0 text-slate-900\" />\n                      )}\n                      <span className=\"font-semibold truncate text-slate-900\">\n                        Deal #{group.dealId}\n                      </span>\n                      <span className=\"text-xs text-muted-foreground\">\n                        {group.payouts.length} payout{group.payouts.length !== 1 && \"s\"}\n                      </span>\n                    </div>\n                                <span className=\"font-data-hud font-bold shrink-0 text-emerald-600\">\n                                    {fmtCurrency(group.total)}\n                                  </span>\n                  </button>\n\n                  {/* Milestone Timeline */}\n                  {isExpanded && (\n                    <div className=\"mt-5 ml-6 border-l-2 border-slate-200 pl-6 space-y-5\">\n                      {group.payouts\n                        .sort(\n                          (a, b) =>\n                            new Date(a.createdAt).getTime() -\n                            new Date(b.createdAt).getTime(),\n                        )\n                        .map((p) => {\n                          const dotColorClass =\n                            p.status === \"completed\"\n                              ? \"bg-slate-900\"\n                              : p.status === \"pending\"\n                                ? \"bg-[#C4972A]\"\n                                : \"bg-gray-300\";\n                          return (\n                            <div key={p.id} className=\"relative\">\n                              {/* Dot */}\n                              <div\n                                className={`absolute -left-[33px] top-1 w-4 h-4 rounded-full border-2 border-white ${dotColorClass}`}\n                              />\n                              <div className=\"flex flex-wrap items-start justify-between gap-2\">\n                                <div className=\"space-y-1\">\n                                  <p className=\"font-medium text-sm text-slate-900\">\n                                    {p.milestoneName ?? getTypeLabel(p.payoutType)}\n                                  </p>\n                                  <div className=\"flex items-center gap-2 flex-wrap\">\n                                    <Badge\n                                      className={`border-0 text-[11px] ${getTypeBadgeClasses(p.payoutType)}`}\n                                    >\n                                      {getTypeLabel(p.payoutType)}\n                                    </Badge>\n                                    <Badge\n                                      className={`${getStatusPillClasses(p.status ?? \"pending\")} border-0 text-[11px]`}\n                                    >\n                                      {p.status ?? \"pending\"}\n                                    </Badge>\n                                    {p.isFollowOn && (\n                                      <span className=\"text-[10px] font-semibold px-1.5 py-0.5 rounded bg-blue-50 text-blue-600\">\n                                        Follow-on\n                                      </span>\n                                    )}\n                                  </div>\n                                  {p.attributionPercentage && (\n                                    <p className=\"text-xs text-muted-foreground\">\n                                      {DASHBOARD.payouts.originationShare} {parseFloat(p.attributionPercentage)}%\n                                      {p.relationshipId && (\n                                        <span className=\"ml-2 text-blue-600\">\n                                          <Link2 className=\"inline w-3 h-3 mr-0.5\" />\n                                          REL-{p.relationshipId}\n                                        </span>\n                                      )}\n                                    </p>\n                                  )}\n                                  {p.status === \"completed\" && p.paidAt && (\n                                    <p className=\"text-xs text-emerald-600\">\n                                      Paid on {format(new Date(p.paidAt), \"MMM d, yyyy\")} ({formatDistanceToNow(new Date(p.paidAt), { addSuffix: true })})\n                                    </p>\n                                  )}\n                                </div>\n                                <span className=\"font-data-hud font-bold text-sm text-slate-900\">\n                                  {fmtCurrency(parseFloat(p.amount))}\n                                </span>\n                              </div>\n                            </div>\n                          );\n                        })}\n                    </div>\n                  )}\n                </div>\n              );\n            })}\n        </div>\n      )}\n    </div>\n  );\n}\n",
  "changes_summary": [
    "Added import for DASHBOARD from @/lib/copy.",
    "Updated 'Lifetime Attribution' stat card header to use DASHBOARD.payouts.lifetimeAttribution.",
    "Added 'Attribution Chain' section heading with a subtitle before the 'Deal Payout Timeline' accordion, styled as specified.",
    "Updated the display of attribution percentage within the deal timeline to include DASHBOARD.payouts.originationShare as a label."
  ],
  "whitepaper_terms_added": [
    "Attribution Chain",
    "Lifetime Attribution"
  ],
  "copy_tokens_used": [
    "DASHBOARD.payouts.lifetimeAttribution",
    "DASHBOARD.payouts.originationShare"
  ]
}